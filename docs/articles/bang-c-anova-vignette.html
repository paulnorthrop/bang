<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hierarchical 1-way Analysis of Variance â€¢ bang</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical 1-way Analysis of Variance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a></li>
    <li><a class="dropdown-item" href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a></li>
    <li><a class="dropdown-item" href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/bang/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hierarchical 1-way Analysis of Variance</h1>
                        <h4 data-toc-skip class="author">Paul J.
Northrop</h4>
            
            <h4 data-toc-skip class="date">2025-11-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/bang/blob/HEAD/vignettes/bang-c-anova-vignette.Rmd"><code>vignettes/bang-c-anova-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>bang-c-anova-vignette.Rmd</code></div>
    </div>

    
    
<p>The <em>bang</em> package simulates from the posterior distributions
involved in certain Bayesian models. See the vignette <a href="bang-a-vignette.html">Introducing bang: Bayesian Analysis, No
Gibbs</a> for an introduction. In this vignette we consider the
hierarchical 1-way Analysis of variance (ANOVA) model:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Î¼</mi><mo>+</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msub><mi>Î¸</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">for</mtext><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>I</mi><mo>,</mo><mspace width="0.167em"></mspace><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>n</mi><mi>i</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation*}
Y_{ij} = \mu + \alpha_i + \epsilon_{ij} = \theta_i + \epsilon_{ij}, \quad\mbox{for} \,\, i = 1, \ldots, I, \, j = 1, \ldots, n_i, 
\end{equation*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_i \sim N(0, \sigma_\alpha^2)</annotation></semantics></math>,
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mo>=</mo><mi>Î¼</mi><mo>+</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_i = \mu + \alpha_i \sim N(\mu, \sigma_\alpha^2)</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_{ij} \sim N(0, \sigma^2)</annotation></semantics></math>
and all random variables are independent. Variability of the response
variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
about an overall level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
is decomposed into contributions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">\alpha_i, i = 1, \ldots, I</annotation></semantics></math>
from an explanatory factor indicating membership of group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and a random error term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\epsilon_{ij}</annotation></semantics></math>.</p>
<p>This model has
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">I + 3</annotation></semantics></math>
parameters:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›Ÿ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}} = (\mu, \sigma_\alpha, \sigma)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›‚</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Î±</mi><mi>I</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\alpha}} = (\alpha_1, \ldots, \alpha_I)</annotation></semantics></math>.
Equivalently, we could replace
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‚</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\alpha}}</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›‰</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î¸</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Î¸</mi><mi>I</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\theta}} = (\theta_1, \ldots, \theta_I)</annotation></semantics></math>.
The full posterior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>,</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\boldsymbol{\mathbf{\alpha}},\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}}) = \pi(\boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{y}}) \, \pi(\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
can be factorized into products of lower-dimensional densities. See the
<a href="#appendix">Appendix</a> for details. If it is assumed that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>
are independent <em>a priori</em> and a normal prior is set for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
then the only challenging part of sampling from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>,</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\boldsymbol{\mathbf{\alpha}},\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
is to simulate from the two-dimensional density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>.
Otherwise, we need to simulate from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\mu, \sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>.
The <em>bang</em> function <code>hanova1</code> uses the <em>rust</em>
package <span class="citation">(Northrop 2017)</span> to simulate from
these densities. In sampling from the marginal posterior density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï•</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\phi \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
we use a parameterization designed to improve the efficiency of
sampling. In this case we work with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\log\sigma_\alpha, \log\sigma)</annotation></semantics></math>.
We illustrate the use of <code>hanova1</code> using two example
datasets. Unless stated otherwise we use the default hyperprior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ</mo><mn>1</mn><mi>/</mi><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\pi(\mu, \sigma_\alpha, \sigma) \propto 1/\sigma</annotation></semantics></math>,
that is, a uniform prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu, \sigma_\alpha, \log\sigma)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>&gt;</mo><mn>0</mn><mo>,</mo><mi>Ïƒ</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma_\alpha&gt;0, \sigma&gt;0</annotation></semantics></math>
(see Sections 5.7 and 11.6 of <span class="citation">Gelman et al.
(2014)</span>). A user-defined prior can be set using
<code>set_user_prior</code>.</p>
<div class="section level2">
<h2 id="late-21st-century-global-temperature-projection-data">Late 21st Century Global Temperature Projection Data<a class="anchor" aria-label="anchor" href="#late-21st-century-global-temperature-projection-data"></a>
</h2>
<p>The data frame <code>temp2</code> contains indices of global
temperature change from late 20th century (1970-1999) to late 21st
century (2069-2098) based on data produced by the Fifth Coupled Model
Intercomparison Project (CMIP5). The dataset is the union of four
subsets, each based on a different greenhouse gas emissions scenario
called a Representative Concentration Pathway (RCP). Here we analyse
only data for RCP2.6. Of course, inferences about the overall
temperature change parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
are important, but it is also interesting to compare the magnitudes of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.
If, for example, if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is much greater than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
then uncertainty about temperature projection associated with choice of
GCM is greater than that associated with the choice of simulation run
from a particular GCM. See <span class="citation">Northrop and Chandler
(2014)</span> for more information.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paulnorthrop.github.io/bang/" class="external-link">bang</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'bang' was built under R version 4.5.2</span></span>
<span><span class="co"># Extract RCP2.6 data</span></span>
<span><span class="va">RCP26_2</span> <span class="op">&lt;-</span> <span class="va">temp2</span><span class="op">[</span><span class="va">temp2</span><span class="op">$</span><span class="va">RCP</span> <span class="op">==</span> <span class="st">"rcp26"</span>, <span class="op">]</span></span></code></pre></div>
<p>There are 61 observations in total distributed rather unevenly across
the 38 GCMs. Only 28 of the GCMs have at least one run available for
RCP2.6.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">RCP26_2</span><span class="op">[</span>, <span class="st">"index"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61</span></span>
<span><span class="co"># Numbers of runs for each GCM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">RCP26_2</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      ACCESS1-0      ACCESS1-3     bcc-csm1-1   bcc-csm1-1-m        BNU-ESM </span></span>
<span><span class="co">#&gt;              0              0              1              1              1 </span></span>
<span><span class="co">#&gt;        CanESM2          CCSM4      CESM1-BGC     CESM1-CAM5        CMCC-CM </span></span>
<span><span class="co">#&gt;              5              6              0              3              0 </span></span>
<span><span class="co">#&gt;       CMCC-CMS       CNRM-CM5  CSIRO-Mk3-6-0       EC-EARTH      FGOALS-g2 </span></span>
<span><span class="co">#&gt;              0              1             10              2              1 </span></span>
<span><span class="co">#&gt;        FIO-ESM       GFDL-CM3     GFDL-ESM2G     GFDL-ESM2M      GISS-E2-H </span></span>
<span><span class="co">#&gt;              3              1              1              1              1 </span></span>
<span><span class="co">#&gt;   GISS-E2-H-CC      GISS-E2-R   GISS-E2-R-CC     HadGEM2-AO     HadGEM2-CC </span></span>
<span><span class="co">#&gt;              0              1              0              1              0 </span></span>
<span><span class="co">#&gt;     HadGEM2-ES         inmcm4   IPSL-CM5A-LR   IPSL-CM5A-MR   IPSL-CM5B-LR </span></span>
<span><span class="co">#&gt;              4              0              4              1              0 </span></span>
<span><span class="co">#&gt;      MIROC-ESM MIROC-ESM-CHEM         MIROC5     MPI-ESM-LR     MPI-ESM-MR </span></span>
<span><span class="co">#&gt;              1              1              3              3              1 </span></span>
<span><span class="co">#&gt;      MRI-CGCM3      NorESM1-M     NorESM1-ME </span></span>
<span><span class="co">#&gt;              1              1              1</span></span>
<span><span class="co"># Number of GCMs with at least one run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">RCP26_2</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 28</span></span></code></pre></div>
<p>We use <code>hanova1</code> to sample from the posterior distribution
of the parameters based on the (default) improper uniform prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu, \log\sigma_\alpha, \sigma)</annotation></semantics></math>,
described in Section 11.6 of <span class="citation">Gelman et al.
(2014)</span>. This prior fits in to the special case considered in the
<a href="#appendix">Appendix</a>, with an infinite prior variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Ïƒ</mi><mn>0</mn><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_0^2</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The response is the index, the explanatory factor is the GCM</span></span>
<span><span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hanova1.html">hanova1</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="st">"index"</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="st">"GCM"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Plots relating to the posterior sample of the variance parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"ru"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-5-1.png" width="331.2"><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-5-2.png" width="331.2"></p>
<p>The plot on the left shows the values sampled from the posterior
distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>
with superimposed density contours. We see that the posterior
distribution is located at values for which
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is much greater than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
by a factor of nearly 10. On the right is a similar plot displayed on
the scale used for sampling,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Ï</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(\rho_1, \rho_2)=(\log \sigma_\alpha, \log \sigma)</annotation></semantics></math>,
after relocation of the posterior mode to the origin and rotation and
scaling to near circularity of the density contours.</p>
<p>We summarize the marginal posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
using a histogram with a superimposed kernel density estimate.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">[</span>, <span class="st">"mu"</span><span class="op">]</span>,  main <span class="op">=</span> <span class="st">""</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, prob <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">[</span>, <span class="st">"mu"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The following plot summarizes the estimated marginal posterior
densities of the mean index for each GCM.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, which_pop <span class="op">=</span> <span class="st">"all"</span>, one_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="coagulation-time-data">Coagulation time data<a class="anchor" aria-label="anchor" href="#coagulation-time-data"></a>
</h2>
<p>In the temperature projection example sampling was conducted on the
scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Î±</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\log\sigma_\alpha, \log\alpha)</annotation></semantics></math>
and was unproblematic. It would also have been unproblematic had we
sampled on the original
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>
scale. To show that there are examples where the latter is not the case
we consider a small dataset presented in Section 11.6 of <span class="citation">Gelman et al. (2014)</span>. The response variable is
the coagulation time of blood drawn from 24 animals allocated to
different diets. The crucial aspect of this dataset is that the
explanatory factor (diet) has only 4 levels. This means that there is
little information about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
in the data. Unless some prior information about
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is provided the posterior distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
will tend to have a heavy upper tail <span class="citation">(Gelman
2006)</span>.</p>
<p>The generalized ratio-of-uniforms method used by <em>rust</em> can
fail for heavy-tailed densities and this is indeed the case for these
data if we try to sample directly from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
using the <em>rust</em> packageâ€™s default settings for the generalized
ratio-of-uniforms algorithm. One solution is to reparameterize to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\log\sigma_\alpha, \log\sigma)</annotation></semantics></math>,
which <code>hanova1</code> implements by default. Another possibility is
to increase the generalized ratio-of-uniforms tuning parameter
<code>r</code> from the default value of 1/2 used in <em>rust</em>.
These approaches are illustrated below.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coag1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hanova1.html">hanova1</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">coag2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hanova1.html">hanova1</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                 param <span class="op">=</span> <span class="st">"original"</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coag1</span>, params <span class="op">=</span> <span class="st">"ru"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coag1</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-8-1.png" width="331.2"><img src="bang-c-anova-vignette_files/figure-html/unnamed-chunk-8-2.png" width="331.2"></p>
<p>The heaviness of the upper tail of the marginal posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is evident in the plot on the left. Parameter transformation to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï</mi><mn>1</mn></msub><mo>,</mo><msub><mi>Ï</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mo>log</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">(\rho_1, \rho_2)=(\log\sigma_\alpha, \log\sigma)</annotation></semantics></math>
results in a density (in the plot on the right) from which it is easier
to simulate.</p>
<p>We produce some summaries of the posterior sample stored in
<code>coag1</code>. The summaries calculated from <code>coag2</code> are
very similar.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">97.5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span>
<span><span class="va">all1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coag1</span><span class="op">$</span><span class="va">theta_sim_vals</span>, <span class="va">coag1</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all1</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;              2.5%  25%  50%  75% 97.5%</span></span>
<span><span class="co">#&gt; theta[1]     58.8 60.4 61.2 62.0  63.8</span></span>
<span><span class="co">#&gt; theta[2]     64.0 65.2 65.9 66.5  67.9</span></span>
<span><span class="co">#&gt; theta[3]     65.7 67.1 67.8 68.4  69.8</span></span>
<span><span class="co">#&gt; theta[4]     59.4 60.5 61.1 61.7  62.9</span></span>
<span><span class="co">#&gt; mu           54.7 62.2 64.0 65.7  73.2</span></span>
<span><span class="co">#&gt; sigma[alpha]  2.0  3.5  5.0  7.9  27.0</span></span>
<span><span class="co">#&gt; sigma         1.8  2.2  2.4  2.7   3.4</span></span></code></pre></div>
<p>These posterior summaries are similar to those presented in Table
11.3 of <span class="citation">Gelman et al. (2014)</span> (where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is denoted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>),
which were obtained using Gibbs sampling.</p>
<p>When the number of groups is small <span class="citation">Gelman
(2006)</span> advocates the use of a half-Cauchy prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>.
The code below implements this using independent half-Cauchy priors for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
that is,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><msubsup><mi>A</mi><mi>Î±</mi><mn>2</mn></msubsup></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><msup><mi>Ïƒ</mi><mn>2</mn></msup><msup><mi>A</mi><mn>2</mn></msup></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>&gt;</mo><mn>0</mn><mo>,</mo><mspace width="0.167em"></mspace><mi>Ïƒ</mi><mo>&gt;</mo><mn>0</mn><mi>.</mi></mrow><annotation encoding="application/x-tex"> 
\pi(\sigma_\alpha, \sigma) \propto 
\left(1 + \frac{\sigma_\alpha^2}{A_\alpha^2}\right)^{-1}
\left(1 + \frac{\sigma^2}{A^2}\right)^{-1}, \quad \sigma_\alpha&gt;0, \, \sigma&gt;0.
</annotation></semantics></math> We choose, somewhat arbitrarily,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">\sigma_\alpha = 10</annotation></semantics></math>:
in practice
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
should be set by considering the problem in hand. See <span class="citation">Gelman (2006)</span> for details. We set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
to be large enough to result in an effectively flat prior for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ïƒ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coag3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hanova1.html">hanova1</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>                 param <span class="op">=</span> <span class="st">"original"</span>, prior <span class="op">=</span> <span class="st">"cauchy"</span>, hpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Consider the hierarchical 1-way ANOVA model
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>Î¼</mi><mo>+</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mspace width="1.0em"></mspace><mtext mathvariant="normal">for</mtext><mspace width="0.167em"></mspace><mspace width="0.167em"></mspace><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>I</mi><mo>,</mo><mspace width="0.167em"></mspace><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>n</mi><mi>i</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation*}
Y_{ij} = \mu + \alpha_i + \epsilon_{ij}, \quad\mbox{for} \,\, i = 1, \ldots, I, \, 
j = 1, \ldots, n_i,  \label{eqn:1way}
\end{equation*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_i \sim N(0, \sigma_\alpha^2)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ïµ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\epsilon_{ij} \sim N(0, \sigma^2)</annotation></semantics></math>
and all random variables are independent. We specify a prior density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\boldsymbol{\mathbf{\phi}})</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›Ÿ</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}} = (\mu, \sigma_\alpha, \sigma)</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ²</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>I</mi><mo>,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{y}} = \{y_{ij}, i=1, \ldots, I, j = 1, \ldots, n_i\}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›‚</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Î±</mi><mi>I</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\alpha}} = (\alpha_1, \ldots, \alpha_I)</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="marginal-posterior-density-of-boldsymbolmathbfphi">Marginal posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#marginal-posterior-density-of-boldsymbolmathbfphi"></a>
</h3>
<p>The joint posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ›‚</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{\alpha}})</annotation></semantics></math>
satisfies
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>,</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><munderover><mo>âˆ</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup></mrow></mfrac><msubsup><mi>Î±</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mi>I</mi></mrow></msubsup><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msubsup><mi>Î±</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">}</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\alpha}},\boldsymbol{\mathbf{\phi}} 
\mid \boldsymbol{\mathbf{y}}) &amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}})
\prod\limits_{i=1}^{I}\prod\limits_{j=1}^{n_i} 
\sigma^{-1} \exp \left[-\frac{1}{2\sigma^2}(y_{ij} - \mu - \alpha_i)^2\right]
\prod_{i=1}^{I} 
\sigma_\alpha^{-1} \exp\left[-\frac{1}{2\sigma^2_\alpha}\alpha_i^2\right]  \nonumber \\
&amp;= \pi(\boldsymbol{\mathbf{\phi}}) \, \sigma^{-n_\cdot} \, \sigma_\alpha^{-I} 
\prod_{i=1}^I \exp \left\{ -\frac12 \left[ \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu - \alpha_i)^2 
+\sigma_\alpha^{-2} \alpha_i^2 \right] \right\},
\label{eqn:joint}
\end{align*}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mo>â‹…</mo></msub><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_\cdot = \sum_{i=1}^{I} n_i</annotation></semantics></math>.
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></msubsup><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\bar{y}_{i\cdot} = (1/n_i) \sum_{j=1}^{n_i} y_{ij}</annotation></semantics></math>.
Completing theÂ square in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Î±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\alpha_i</annotation></semantics></math>
in the term in square brackets gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msubsup><mi>Î±</mi><mi>i</mi><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><mn>2</mn><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>Î±</mi><mi>i</mi><mn>2</mn></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><msub><mi>n</mi><mi>i</mi></msub><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ’</mo><mfrac><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><mfrac><mrow><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>4</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac><mo>+</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>a</mi><mi>i</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>b</mi><mi>i</mi></msub><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
&amp;\sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu - \alpha_i)^2 + \sigma_\alpha^{-2} \alpha_i^2 \\
&amp;=
\sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu)^2 
- 2 n_i \sigma^{-2} (\bar{y}_{i\cdot} - \mu) \alpha_i + (n_i \sigma^{-2} + \sigma_\alpha^{-2})\alpha_i^2 \\
&amp;= (\sigma^{-2} n_i + \sigma_{\alpha}^{-2}) 
\left[ \alpha_i - \frac{n_i \sigma^{-2} (\bar{y}_{i\cdot} - \mu)}{n_i \sigma^{-2} + \sigma_{\alpha}^{-2}} \right]^2
- \frac{n_i^2 \sigma^{-4} (\bar{y}_{i\cdot} - \mu)^2}{n_i \sigma^{-2} + \sigma_{\alpha}^{-2}}
+ \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu)^2 \\
&amp;= a_i (\alpha_i - b_i / a_i)^2 + c_i - b_i^2 / a_i,
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo>,</mo><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a_i = n_i \sigma^{-2} + \sigma_\alpha^{-2},
b_i = n_i \sigma^{-2} (\bar{y}_{i\cdot} - \mu)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">c_i = \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu)^2</annotation></semantics></math>.
Therefore,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mi>I</mi></mrow></msubsup><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>b</mi><mi>i</mi></msub><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{y}}) 
&amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}}) \, \sigma^{-n_\cdot} \, \sigma_\alpha^{-I} 
\prod_{i=1}^I \exp\left[ -\frac12 \left( c_i - b_i ^ 2 / a_i \right) \right]
\exp\left[ -\frac{1}{2a_i^{-1}} \left( \alpha_i - b_i / a_i \right)^2 \right]. \\
\end{align*}</annotation></semantics></math></p>
<p>The marginal posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math>
is given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>âˆ«</mo><mrow><mi>âˆ’</mi><mi>âˆ</mi></mrow><mi>âˆ</mi></msubsup><mi>â‹¯</mi><msubsup><mo>âˆ«</mo><mrow><mi>âˆ’</mi><mi>âˆ</mi></mrow><mi>âˆ</mi></msubsup><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>,</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">Â d</mtext><msub><mi>Î±</mi><mn>1</mn></msub><mi>â‹¯</mi><mtext mathvariant="normal">Â d</mtext><msub><mi>Î±</mi><mi>I</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mi>I</mi></mrow></msubsup><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><msubsup><mo>âˆ«</mo><mrow><mi>âˆ’</mi><mi>âˆ</mi></mrow><mi>âˆ</mi></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>b</mi><mi>i</mi></msub><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mtext mathvariant="normal">Â d</mtext><msub><mi>Î±</mi><mi>i</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mi>I</mi></mrow></msubsup><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>âˆ’</mi><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}}) 
&amp;=
\int_{-\infty}^{\infty}\cdots\int_{-\infty}^{\infty}
\pi(\boldsymbol{\mathbf{\alpha}}, \boldsymbol{\mathbf{\phi}} 
\mid \boldsymbol{\mathbf{y}}) \text{~d}\alpha_1 \cdots \text{~d}\alpha_I \\
&amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}}) \, \sigma^{-n_\cdot} \, \sigma_\alpha^{-I} 
\prod_{i=1}^I \exp\left[ -\frac12 \left( c_i - b_i ^ 2 / a_i \right) \right]
\int_{-\infty}^{\infty} \exp\left[ -\frac{1}{2a_i^{-1}} \left( \alpha_i - b_i / a_i \right)^2 \right] \text{~d}\alpha_i \\
&amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}}) \, \sigma^{-n_\cdot} \, \sigma_\alpha^{-I} 
\prod_{i=1}^I a_i^{-1/2} \exp\left[ -\frac12 \left( c_i - b_i ^ 2 / a_i \right) \right] \\
&amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}}) \, \sigma^{I-n_\cdot} \, 
\prod_{i=1}^I (\sigma_\alpha^2+\sigma^2/n_i)^{-1/2} \exp\left[ -\frac12 \left( c_i - b_i ^2 / a_i \right) \right].
\end{align*}</annotation></semantics></math> Manipulating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c_i - b_i ^2 / a_i</annotation></semantics></math>
gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>c</mi><mi>i</mi></msub><mo>âˆ’</mo><msubsup><mi>b</mi><mi>i</mi><mn>2</mn></msubsup><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><mfrac><mrow><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>4</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">[</mo><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>âˆ’</mo><mfrac><mrow><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>4</mn></mrow></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mfrac><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ’</mo><msubsup><mi>n</mi><mi>i</mi><mn>2</mn></msubsup><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>4</mn></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><msub><mi>n</mi><mi>i</mi></msub><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><mo>+</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Ïƒ</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msup><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mfrac><mn>1</mn><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
c_i - b_i ^ 2 / a_i 
  &amp;= \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \mu)^2 
   - \frac{n_i^2 \sigma^{-4} (\bar{y}_{i\cdot} - \mu)^2}
  {n_i \sigma^{-2} + \sigma_\alpha^{-2}} \\
  &amp;= \sigma^{-2} \left[ \sum_{j=1}^{n_i} (y_{ij} - \bar{y}_{i\cdot})^2 
   + n_i (\bar{y}_{i\cdot} - \mu)^2 \right]
   - \frac{n_i^2 \sigma^{-4} (\bar{y}_{i\cdot} - \mu)^2}
  {n_i \sigma^{-2} + \sigma_\alpha^{-2}} \\
  &amp;= \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \bar{y}_{i\cdot})^2 +
   \frac{\left[ n_i \sigma^{-2} \left(n_i \sigma^{-2}+\sigma_\alpha^{-2}\right)
    - n_i^2 \sigma^{-4} \right]}{n_i \sigma^{-2} + \sigma_\alpha^{-2}}
    (\bar{y}_{i\cdot} - \mu)^2 \\
  &amp;= \sigma^{-2} \sum_{j=1}^{n_i} (y_{ij} - \bar{y}_{i\cdot})^2 
   + \frac{1}{\sigma_\alpha^2 + \sigma^2 / n_i} (\mu - \bar{y}_{i\cdot})^2.
\end{align*}</annotation></semantics></math> Therefore, the joint
posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math>
satisfies
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>Ïƒ</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}}) 
&amp;\propto 
\pi(\boldsymbol{\mathbf{\phi}}) \, 
\sigma^{I-n_\cdot} \, 
\exp\left( -\frac{1}{2\sigma^{2}} S \right)
\prod_{i=1}^I \sigma_i^{-1} 
\exp\left[ -\frac{1}{2 \sigma_i^2} (\mu - \mu_i)^2 \right],
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msubsup><mo>âˆ‘</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>n</mi><mi>i</mi></msub></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>âˆ’</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">S = \sum_{i=1}^I \sum_{j=1}^{n_i} (y_{ij} - \bar{y}_{i\cdot})^2</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¼</mi><mi>i</mi></msub><mo>=</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub></mrow><annotation encoding="application/x-tex">\mu_i = \bar{y}_{i\cdot}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Ïƒ</mi><mi>i</mi><mn>2</mn></msubsup><mo>=</mo><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\sigma_i^2 = \sigma_\alpha^2 + \sigma^2/n_i</annotation></semantics></math>.</p>
<div class="section level4">
<h4 id="a-special-case">A special case<a class="anchor" aria-label="anchor" href="#a-special-case"></a>
</h4>
<p>Suppose that a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>Î¼</mi><mn>0</mn></msub><mo>,</mo><msubsup><mi>Ïƒ</mi><mn>0</mn><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">N(\mu_0, \sigma_0^2</annotation></semantics></math>)
prior distribution is specified for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>,
so that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>âˆ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><msubsup><mi>Ïƒ</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="false" form="postfix">)</mo><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\mu) \propto \exp[-\sigma_0^{-2}(\mu-\mu_0)^2) / 2]</annotation></semantics></math>
and that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>
are independent <em>a priori</em>. We derive the marginal posterior
density for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>
in this case and the conditional posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>.
The joint posterior density for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu, \sigma_\alpha, \sigma)</annotation></semantics></math>
satisfies
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>Ïƒ</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><mi>S</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mn>2</mn></mfrac><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\mu, \sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})
&amp;\propto \pi(\mu) \, \pi(\sigma_\alpha, \sigma) \, 
\sigma^{I-n_\cdot} \, 
\exp\left( -\frac{1}{2\sigma^{2}} S \right)
\prod_{i=1}^I \sigma_i^{-1} 
\exp\left[ -\frac{1}{2 \sigma_i^2} (\mu - \mu_i)^2 \right], \\
&amp;=
\pi(\sigma_\alpha, \sigma) \, 
\sigma^{I-n_\cdot} \, 
\exp\left( -\frac{1}{2\sigma^{2}} S \right)
\left(\prod_{i=1}^I \sigma_i^{-1} \right)
\exp\left[
-\frac{1}{2} \sum_{i=0}^{I} \sigma_i^{-2} (\mu - \mu_i)^2 
\right],
\end{align*}</annotation></semantics></math> Completing the square in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></msubsup><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\sum_{i=0}^{I} \sigma_i^{-2} (\mu - \mu_i)^2</annotation></semantics></math>
gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>Î¼</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Î¼</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>2</mn><mi>Î¼</mi><msub><mi>Î¼</mi><mi>i</mi></msub><mo>+</mo><msubsup><mi>Î¼</mi><mi>i</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msup><mi>Î¼</mi><mn>2</mn></msup><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo>âˆ’</mo><mn>2</mn><mi>Î¼</mi><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msub><mi>Î¼</mi><mi>i</mi></msub><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo>+</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Î¼</mi><mi>i</mi><mn>2</mn></msubsup><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><mfrac><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msub><mi>Î¼</mi><mi>i</mi></msub><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mspace width="-0.167em"></mspace><mspace width="-0.167em"></mspace><mn>2</mn></mrow></msup><mo>âˆ’</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msub><mi>Î¼</mi><mi>i</mi></msub><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mrow></mfrac><mo>+</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></munderover><msubsup><mi>Î¼</mi><mi>i</mi><mn>2</mn></msubsup><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>S</mi><mn>0</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>S</mi><mn>1</mn></msub><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>âˆ’</mo><msubsup><mi>S</mi><mn>1</mn><mn>2</mn></msubsup><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>+</mo><msub><mi>S</mi><mn>2</mn></msub><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\sum_{i=0}^{I} \sigma_i^{-2} (\mu - \mu_i)^2 
&amp;= 
\sum_{i=0}^{I} \sigma_i^{-2} (\mu^2 - 2 \mu \mu_i + \mu_i^2) \\
&amp;=
\mu^2 \sum_{i=0}^{I} \sigma_i^{-2} 
- 2 \mu \sum_{i=0}^{I} \mu_i \sigma_i^{-2} 
+ \sum_{i=0}^{I} \mu_i ^2 \sigma_i^{-2} \\ 
&amp;=
\left(\sum_{i=0}^{I} \sigma_i^{-2} \right)
\left( \mu - \frac{\sum_{i=0}^{I} \mu_i \sigma_i^{-2}}
{\sum_{i=0}^{I} \sigma_i^{-2}} \right)^{\!\!2}
- \frac{\left( \sum_{i=0}^{I} \mu_i \sigma_i^{-2} \right)^2}
{\sum_{i=0}^{I} \sigma_i^{-2}}
+ \sum_{i=0}^{I} \mu_i^{2} \sigma_i^{-2} \\
&amp;= 
S_0 (\mu - S_1 S_0^{-1})^2
- S_1^2 S_0^{-1} + S_2, \\
\end{align*}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>j</mi></msub><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>I</mi></msubsup><msubsup><mi>Î¼</mi><mi>i</mi><mi>j</mi></msubsup><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>2</mn></mrow></msubsup><mo>,</mo><mspace width="0.167em"></mspace><mi>j</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">S_j = \sum_{i=0}^{I} \mu_i^{j} \sigma_i^{-2}, \, j = 0, 1, 2</annotation></semantics></math>.
Therefore,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msubsup><mo>âˆ«</mo><mrow><mi>âˆ’</mi><mi>âˆ</mi></mrow><mi>âˆ</mi></msubsup><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">Â d</mtext><mi>Î¼</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><mi>S</mi><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>S</mi><mn>1</mn><mn>2</mn></msubsup><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mphantom><mo>âˆ</mo></mphantom><mo>Ã—</mo><msubsup><mo>âˆ«</mo><mrow><mi>âˆ’</mi><mi>âˆ</mi></mrow><mi>âˆ</mi></msubsup><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>S</mi><mn>1</mn></msub><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">}</mo></mrow><mtext mathvariant="normal">Â d</mtext><mi>Î¼</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mrow><mi>I</mi><mo>âˆ’</mo><msub><mi>n</mi><mo>â‹…</mo></msub></mrow></msup><mspace width="0.167em"></mspace><mo>exp</mo><mrow><mo stretchy="true" form="prefix">{</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msup><mi>Ïƒ</mi><mn>2</mn></msup></mrow></mfrac><mi>S</mi><mo stretchy="true" form="postfix">}</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><msubsup><mi>Ïƒ</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>S</mi><mn>1</mn><mn>2</mn></msubsup><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msub><mi>S</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn><mi>/</mi><mn>2</mn></mrow></msubsup><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})
&amp;=
\int_{-\infty}^{\infty} 
\pi(\mu, \sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})
\text{~d}\mu \\
&amp;\propto
\pi(\sigma_\alpha, \sigma) \, 
\sigma^{I-n_\cdot} \, 
\exp\left\{ -\frac{1}{2\sigma^{2}} S \right\}
\left(\prod_{i=1}^I \sigma_i^{-1} \right)
\exp\left( \frac12 S_1^2 S_0^{-1} - \frac12 S_2 \right) \\
&amp;\phantom{\propto} \times 
\int_{-\infty}^{\infty} 
\exp\left\{ -\frac{1}{2 S_0^{-1}} (\mu - S_1 S_0^{-1})^2
\right\}
\text{~d}\mu \\
&amp;\propto
\pi(\sigma_\alpha, \sigma) \, 
\sigma^{I-n_\cdot} \, 
\exp\left\{ -\frac{1}{2\sigma^{2}} S \right\}
\left(\prod_{i=1}^I \sigma_i^{-1} \right)
\exp\left( \frac12 S_1^2 S_0^{-1} - \frac12 S_2 \right) 
S_0^{-1/2}.
\end{align*}</annotation></semantics></math></p>
<p>Retaining only the terms in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>,</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\mu, \sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
that involve
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Î¼</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ£</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ’</mo><msub><mi>S</mi><mn>1</mn></msub><mi>/</mi><msub><mi>S</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\mu \mid \sigma_\alpha, \sigma, \boldsymbol{\mathbf{y}}) 
&amp;\propto 
\exp\left[ -\frac{1}{2 S_0^{-1}} (\mu - S_1 / S_0)^2 \right].
\end{align*}</annotation></semantics></math> Therefore,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>âˆ£</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>,</mo><mi>ğ²</mi><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>S</mi><mn>1</mn></msub><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>,</mo><msubsup><mi>S</mi><mn>0</mn><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu \mid \sigma_\alpha, \sigma, \boldsymbol{\mathbf{y}}
\sim N(S_1 S_0^{-1}, S_0^{-1})</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level3">
<h3 id="the-conditional-posterior-density-of-boldsymbolmathbftheta-given-boldsymbolmathbfphi">The conditional posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‰</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\theta}}</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#the-conditional-posterior-density-of-boldsymbolmathbftheta-given-boldsymbolmathbfphi"></a>
</h3>
<p>The conditional posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›‚</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\alpha}}</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math>
satisfies
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>âˆ</mo><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mi>âˆ’</mi><mfrac><mn>1</mn><mrow><mn>2</mn><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>b</mi><mi>i</mi></msub><mi>/</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{\phi}}, 
\boldsymbol{\boldsymbol{\mathbf{y}}}) 
&amp;\propto \prod_{i=1}^I \exp\left[ -\frac{1}{2a_i^{-1}} \left( \alpha_i - b_i / a_i \right)^2 \right],
\end{align*}</annotation></semantics></math> because these are the only
terms in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi (\boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
that involve
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>â€¦</mi><mo>,</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">\alpha_i, i = 1, \ldots, I</annotation></semantics></math>.
Therefore, conditional on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Î±</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_1, \ldots, \alpha_I</annotation></semantics></math>
are independent <em>a posteriori</em> and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>b</mi><mi>i</mi></msub><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo>,</mo><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\alpha_i \mid \boldsymbol{\mathbf{\phi}},
\boldsymbol{\mathbf{y}} \sim N(b_i a_i^{-1}, a_i^{-1})</annotation></semantics></math>,
where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>b</mi><mi>i</mi></msub><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mspace width="0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><mo>âˆ’</mo><mi>Î¼</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow></mfrac><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
b_i a_i^{-1} &amp;= 
\frac{\sigma_\alpha^2 \, (\bar{y}_{i\cdot} - \mu)} 
{\sigma_\alpha^{2} + \sigma^2 / n_i} \\
a_i^{-1} &amp;= \frac{\sigma_\alpha^2 \, \sigma^2 / n_i}
{\sigma_\alpha^{2} + \sigma^2 / n_i}. \\
\end{align*}</annotation></semantics></math> Noting that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mo>=</mo><mi>Î¼</mi><mo>+</mo><msub><mi>Î±</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\theta_i = \mu + \alpha_i</annotation></semantics></math>
gives
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo>âˆ¼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>Î¸</mi><mo accent="true">Ì‚</mo></mover><mi>i</mi></msub><mo>,</mo><msubsup><mi>a</mi><mi>i</mi><mrow><mi>âˆ’</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_i \mid \boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{y}} \sim N(\hat{\theta}_i, a_i^{-1})</annotation></semantics></math>,
where
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mover><mi>Î¸</mi><mo accent="true">Ì‚</mo></mover><mi>i</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mfrac><mrow><msub><mover><mi>y</mi><mo accent="true">â€¾</mo></mover><mrow><mi>i</mi><mo>â‹…</mo></mrow></msub><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><mi>Î¼</mi><mspace width="0.167em"></mspace><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow><mrow><msubsup><mi>Ïƒ</mi><mi>Î±</mi><mn>2</mn></msubsup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mi>/</mi><msub><mi>n</mi><mi>i</mi></msub></mrow></mfrac><mi>.</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\hat{\theta}_i &amp;= 
\frac{\bar{y}_{i\cdot} \sigma_\alpha^2 + \mu \, \sigma ^ 2 / n_i} 
{\sigma_\alpha^{2} + \sigma^2 / n_i}. \\
\end{align*}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="factorisations-for-simulation">Factorisations for simulation<a class="anchor" aria-label="anchor" href="#factorisations-for-simulation"></a>
</h3>
<p>In the most general case considered here the factorisation
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{y}})
&amp;= \pi(\boldsymbol{\mathbf{\phi}} \mid \boldsymbol{\mathbf{y}})
\, \prod_{i=1}^{I} \pi(\alpha_i \mid \boldsymbol{\mathbf{\phi}}, 
\boldsymbol{\boldsymbol{\mathbf{y}}})
\end{align*}</annotation></semantics></math> means that we can simulate
first from the three-dimensional
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>âˆ£</mi><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\boldsymbol{\mathbf{\phi}}, \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
and then, conditional on the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ğ›Ÿ</mi><annotation encoding="application/x-tex">\boldsymbol{\mathbf{\phi}}</annotation></semantics></math>,
simulate independently from each of the normal distributions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi></mrow><annotation encoding="application/x-tex">\alpha_i \mid \boldsymbol{\mathbf{\phi}}, \boldsymbol{\boldsymbol{\mathbf{y}}}</annotation></semantics></math>.</p>
<p>In the special case detailed above the factorisation becomes
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ›‚</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>Î¼</mi><mo>âˆ£</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><munderover><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Î±</mi><mi>i</mi></msub><mo>âˆ£</mo><mi>ğ›Ÿ</mi><mo>,</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
\pi(\boldsymbol{\mathbf{\phi}}, \boldsymbol{\mathbf{\alpha}} \mid \boldsymbol{\mathbf{y}})
&amp;= \pi(\sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})
\, \pi(\mu \mid \sigma_\alpha, \sigma, \boldsymbol{\mathbf{y}})
\, \prod_{i=1}^{I} \pi(\alpha_i \mid \boldsymbol{\mathbf{\phi}}, 
\boldsymbol{\boldsymbol{\mathbf{y}}}).
\end{align*}</annotation></semantics></math> Therefore, the first stage
can be performed by simulating from the two-dimensional
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>âˆ£</mo><mi>ğ²</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\pi(\sigma_\alpha, \sigma \mid \boldsymbol{\mathbf{y}})</annotation></semantics></math>
and then, conditional on the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\sigma_\alpha, \sigma)</annotation></semantics></math>,
from the normal distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î¼</mi><mo>âˆ£</mo><msub><mi>Ïƒ</mi><mi>Î±</mi></msub><mo>,</mo><mi>Ïƒ</mi><mo>,</mo><mi>ğ²</mi></mrow><annotation encoding="application/x-tex">\mu \mid \sigma_\alpha, \sigma, \boldsymbol{\mathbf{y}}</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Gelman2006" class="csl-entry">
Gelman, A. 2006. <span>â€œPrior Distributions for Variance Parameters in
Hierarchical Models.â€</span> <em><span>B</span>ayesian Analysis</em> 1
(3): 515â€“33. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">https://doi.org/10.1214/06-BA117A</a>.
</div>
<div id="ref-BDA2014" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D.
B. Rubin. 2014. <em>Bayesian Data Analysis</em>. Third. Florida, USA:
Chapman &amp; Hall / CRC. <a href="http://www.stat.columbia.edu/~gelman/book/" class="external-link">http://www.stat.columbia.edu/~gelman/book/</a>.
</div>
<div id="ref-rust" class="csl-entry">
Northrop, P. J. 2017. <em><span class="nocase">r</span>ust:
Ratio-of-Uniforms Simulation with Transformation</em>. <a href="https://CRAN.R-project.org/package=rust" class="external-link">https://CRAN.R-project.org/package=rust</a>.
</div>
<div id="ref-NC2014" class="csl-entry">
Northrop, P. J., and R. E. Chandler. 2014. <span>â€œQuantifying Sources of
Uncertainty in Projections of Future Climateâ€</span> 27: 8793â€“8808. <a href="https://doi.org/10.1175/JCLI-D-14-00265.1" class="external-link">https://doi.org/10.1175/JCLI-D-14-00265.1</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
