<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Posterior Predictive Checking â€¢ bang</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Posterior Predictive Checking">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a></li>
    <li><a class="dropdown-item" href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a></li>
    <li><a class="dropdown-item" href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/bang/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Posterior Predictive Checking</h1>
                        <h4 data-toc-skip class="author">Paul J.
Northrop</h4>
            
            <h4 data-toc-skip class="date">2025-11-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/bang/blob/HEAD/vignettes/bang-d-ppc-vignette.Rmd"><code>vignettes/bang-d-ppc-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>bang-d-ppc-vignette.Rmd</code></div>
    </div>

    
    
<p>This short vignette illustrates the use of the <code>pp_check</code>
method <code>pp_check.hef</code>, which provides an interface to the
posterior predictive checking graphics in the <em>bayesplot</em> package
<span class="citation">(Gabry and Mahr 2017)</span>. For details see the
bayesplot vignette <a href="https://CRAN.R-project.org/package=bayesplot" class="external-link">Graphical posterior
predictive checks</a>. and/or Chapter 6 of <span class="citation">Gelman
et al. (2014)</span>. <em>bayesplot</em> functions return a
<code>ggplot</code> object that can be customised using the
<em>gglot2</em> package <span class="citation">(Wickham
2016)</span>.</p>
<p>We revisit the examples presented in the vignettes <a href="bang-c-anova-vignette.html">Hierarchical 1-way Analysis of
Variance</a> and <a href="bang-b-hef-vignette.html">Conjugate
Hierarchical Models</a>. In the code below <code>hef</code> and
<code>hanova1</code> have been called with the extra argument
<code>nrep = 50</code>. This results in 50 simulated replicates of the
data, returned in <code>object$data_rep</code>, on which posterior
predictive checking can be based. The general idea is that if the model
fits well then the observed data should not appear unusual when compared
to replicates from the posterior predictive distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://paulnorthrop.github.io/bang/" class="external-link">bang</a></span><span class="op">)</span></span>
<span><span class="co"># Beta-binomial rat tumor example</span></span>
<span><span class="va">rat_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hef.html">hef</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"beta_binom"</span>, data <span class="op">=</span> <span class="va">rat</span>, nrep <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co"># Gamma-Poisson pump failure example</span></span>
<span><span class="va">pump_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hef.html">hef</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gamma_pois"</span>, data <span class="op">=</span> <span class="va">pump</span>, nrep <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co"># 1-way Hierarchical ANOVA global warming example</span></span>
<span><span class="va">RCP26_2</span> <span class="op">&lt;-</span> <span class="va">temp2</span><span class="op">[</span><span class="va">temp2</span><span class="op">$</span><span class="va">RCP</span> <span class="op">==</span> <span class="st">"rcp26"</span>, <span class="op">]</span></span>
<span><span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hanova1.html">hanova1</a></span><span class="op">(</span>resp <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, nrep <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p>We show some examples of the graphical posterior predictive checks
that are available from <em>bayesplot</em>, but make no comments on
their content. The commented lines above the calls to
<code>pp_check</code> describe briefly the type of plot produced.</p>
<div class="section level2">
<h2 id="beta-binomial-model">Beta-binomial model<a class="anchor" aria-label="anchor" href="#beta-binomial-model"></a>
</h2>
<p>The aspect of the data that appears in these plots is the proportion
of successful trials.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is bayesplot version 1.14.0</span></span>
<span><span class="co">#&gt; - Online documentation and vignettes at mc-stan.org/bayesplot</span></span>
<span><span class="co">#&gt; - bayesplot theme set to bayesplot::theme_default()</span></span>
<span><span class="co">#&gt;    * Does _not_ affect other ggplot2 plots</span></span>
<span><span class="co">#&gt;    * See ?bayesplot_theme_set for details on theme setting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># Overlaid density estimates</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span><span class="co"># Overlaid distribution function estimates</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span>, fun <span class="op">=</span> <span class="st">"ecdf_overlay"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-3-1.png" width="331.2"><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-3-2.png" width="331.2"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multiple histograms</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span>, fun <span class="op">=</span> <span class="st">"hist"</span>, nrep <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span></span>
<span><span class="co"># Multiple boxplots</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span>, fun <span class="op">=</span> <span class="st">"boxplot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-4-1.png" width="672"><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictive medians vs observed median</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span>, fun <span class="op">=</span> <span class="st">"stat"</span>, stat <span class="op">=</span> <span class="st">"median"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value `binwidth`.</span></span>
<span><span class="co"># Predictive (mean, sd) vs observed (mean, sd)</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">rat_res</span>, fun <span class="op">=</span> <span class="st">"stat_2d"</span>, stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: in most cases the default test statistic 'mean' is too weak to detect anything of interest.</span></span></code></pre></div>
<p><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-5-1.png" width="672"><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-5-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="gamma-poisson-model">Gamma-Poisson model<a class="anchor" aria-label="anchor" href="#gamma-poisson-model"></a>
</h2>
<p>The aspect of the data that appears in these plots is the
exposure-adjusted rate <span class="math inline">\(y_j / e_j\)</span>,
where <span class="math inline">\(y_j\)</span> is the observed count and
<span class="math inline">\(e_j\)</span> a measure of exposure. See the
<a href="bang-b-hef-vignette.html">Conjugate Hierarchical Models</a>
vignette for more detail.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overlaid density estimates</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">pump_res</span><span class="op">)</span></span>
<span><span class="co"># Predictive (mean, sd) vs observed (mean, sd)</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">pump_res</span>, fun <span class="op">=</span> <span class="st">"stat_2d"</span>, stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: in most cases the default test statistic 'mean' is too weak to detect anything of interest.</span></span></code></pre></div>
<p><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-6-1.png" width="672"><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-6-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="one-way-hierarchical-anova">One-way Hierarchical ANOVA<a class="anchor" aria-label="anchor" href="#one-way-hierarchical-anova"></a>
</h2>
<p>The raw responses appear in these plots.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Overlaid density estimates</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">)</span></span>
<span><span class="co"># Predictive (mean, sd) vs observed (mean, sd)</span></span>
<span><span class="fu"><a href="../reference/pp_check.hef.html">pp_check</a></span><span class="op">(</span><span class="va">temp_res</span>, fun <span class="op">=</span> <span class="st">"stat_2d"</span>, stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: in most cases the default test statistic 'mean' is too weak to detect anything of interest.</span></span></code></pre></div>
<p><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-7-1.png" width="672"><img src="bang-d-ppc-vignette_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bayesplot" class="csl-entry">
Gabry, Jonah, and Tristan Mahr. 2017. <em>Bayesplot: Plotting for
Bayesian Models</em>. <a href="https://CRAN.R-project.org/package=bayesplot" class="external-link">https://CRAN.R-project.org/package=bayesplot</a>.
</div>
<div id="ref-BDA2014" class="csl-entry">
Gelman, A., J. B. Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, and D.
B. Rubin. 2014. <em>Bayesian Data Analysis</em>. Third. Florida, USA:
Chapman &amp; Hall / CRC. <a href="http://www.stat.columbia.edu/~gelman/book/" class="external-link">http://www.stat.columbia.edu/~gelman/book/</a>.
</div>
<div id="ref-ggplot2" class="csl-entry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data
Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org" class="external-link">https://ggplot2.tidyverse.org</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
