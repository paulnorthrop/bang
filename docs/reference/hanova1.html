<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Posterior sampling for a 1-way hierarchical ANOVA — hanova1 • bang</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Posterior sampling for a 1-way hierarchical ANOVA — hanova1"><meta name="description" content="Produces random samples from the posterior distribution of the parameters
of a 1-way hierarchical ANOVA model."><meta property="og:description" content="Produces random samples from the posterior distribution of the parameters
of a 1-way hierarchical ANOVA model."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a></li>
    <li><a class="dropdown-item" href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a></li>
    <li><a class="dropdown-item" href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a></li>
    <li><a class="dropdown-item" href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/paulnorthrop/bang/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Posterior sampling for a 1-way hierarchical ANOVA</h1>
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/bang/blob/HEAD/R/one_way_anova.R"><code>R/one_way_anova.R</code></a></small>
      <div class="d-none name"><code>hanova1.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Produces random samples from the posterior distribution of the parameters
of a 1-way hierarchical ANOVA model.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hanova1</span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="va">resp</span>,</span>
<span>  <span class="va">fac</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  prior <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  hpars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trans"</span>, <span class="st">"original"</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mu0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  sigma0 <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  nrep <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>A numeric scalar.  The size of posterior sample required.</p></dd>


<dt id="arg-resp">resp<a class="anchor" aria-label="anchor" href="#arg-resp"></a></dt>
<dd><p>A numeric vector.  Response values.</p></dd>


<dt id="arg-fac">fac<a class="anchor" aria-label="anchor" href="#arg-fac"></a></dt>
<dd><p>A vector of class <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></code> indicating the group from
which the corresponding element of <code>resp</code> originates.
Must have the same length as <code>resp</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Optional further arguments to be passed to
<code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>The log-prior for the parameters of the hyperprior
distribution.  If the user wishes to specify their own prior then
<code>prior</code> must be an object returned from a call to
<code><a href="set_user_prior.html">set_user_prior</a></code>.
Otherwise, <code>prior</code> is a character scalar giving the name of the
required in-built prior.
If <code>prior</code> is not supplied then a default prior is used.
See <strong>Details</strong>.</p></dd>


<dt id="arg-hpars">hpars<a class="anchor" aria-label="anchor" href="#arg-hpars"></a></dt>
<dd><p>A numeric vector.  Used to set parameters (if any) in
an in-built prior.  If <code>prior = cauchy</code> then <code>hpars</code> is
a numeric vector of length 2 giving the respective scale parameters
of the half-Cauchy priors for \(\sigma_\alpha\) and \(\sigma\).</p></dd>


<dt id="arg-param">param<a class="anchor" aria-label="anchor" href="#arg-param"></a></dt>
<dd><p>A character scalar.
If <code>param = "trans"</code> (the default) then the marginal posterior
of hyperparameter vector \(\phi\) is reparameterized in terms of
\(log \sigma_\alpha, log \sigma\).
If <code>param = "original"</code> the original parameterization,
i.e. \(\sigma_\alpha, \sigma\) is used.
The former tends to make the optimizations involved in the
ratio-of-uniforms algorithm more stable and to increase the probability
of acceptance, but at the expense of slower function evaluations.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>A numeric vector. Optional initial estimates sent to
<code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> in the search for the mode of the posterior
density of (perhaps a subset of) the hyperparameter vector \(\phi\).
If an in-built prior is used then <code>ru</code> is used to sample from the
marginal posterior density of \((\sigma_\alpha, \sigma)\), so
<code>init</code> must have length 2.  Otherwise, <code>init</code> has length
equal to the argument <code>anova_d</code> supplied to
<code><a href="set_user_prior.html">set_user_prior</a></code>.</p></dd>


<dt id="arg-mu-sigma-">mu0, sigma0<a class="anchor" aria-label="anchor" href="#arg-mu-sigma-"></a></dt>
<dd><p>A numeric scalar.  Mean and standard deviation of a
normal prior for \(\mu\).  Only used if an in-built prior is used
or if <code>anova_d = 2</code> is supplied in a call to
<code><a href="set_user_prior.html">set_user_prior</a></code> to set a user-defined prior.
The default, <code>sigma0 = Inf</code>, sets an improper uniform prior
for \(\mu\).</p></dd>


<dt id="arg-nrep">nrep<a class="anchor" aria-label="anchor" href="#arg-nrep"></a></dt>
<dd><p>A numeric scalar.  If <code>nrep</code> is not <code>NULL</code> then
<code>nrep</code> gives the number of replications of the original dataset
simulated from the posterior predictive distribution.
Each replication is based on one of the samples from the posterior
distribution.  Therefore, <code>nrep</code> must not be greater than <code>n</code>.
In that event <code>nrep</code> is set equal to <code>n</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object (list) of class <code>"hef"</code>, which has the same
  structure as an object of class "ru" returned from <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.
  In particular, the columns of the <code>n</code>-row matrix <code>sim_vals</code>
  contain the simulated values of \(\phi\).
  In addition this list contains the arguments <code>model</code>, <code>resp</code>,
  <code>fac</code> and <code>prior</code> detailed above and an <code>n</code> by \(I\)
  matrix <code>theta_sim_vals</code>: column \(i\) contains the simulated
  values of  \(\theta\)\(i\).  Also included are
  <code>data = cbind(resp, fac)</code> and <code>summary_stats</code> a list
  containing: the number of groups <code>I</code>; the numbers of responses
  each group <code>ni</code>; the total number of observations; the sample mean
  response in each group; the sum of squared deviations from the
  group means <code>s</code>; the arguments to <code>hanova1</code> <code>mu0</code> and
  <code>sigma0</code>; <code>call</code>: the matched call to <code>hanova1</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Consider \(I\) independent experiments in which the \(ni\) responses
  <strong>\(y\)</strong>\(i\) from experiment/group \(i\) are normally
  distributed with mean \(\theta i\) and standard deviation \(\sigma\).
  The population parameters \(\theta\)1, ...,
  \(\theta\)\(I\) are modelled as random samples from a normal
  distribution with mean \(\mu\) and standard deviation
  \(\sigma_\alpha\).  Let \(\phi = (\mu, \sigma_\alpha, \sigma)\).
  Conditionally on \(\theta\)1, ..., \(\theta\)\(I\),
  <strong>\(y\)</strong>1, ..., <strong>\(y\)</strong>\(I\)
  are independent of each other and are independent of \(\phi\).
  A <em>hyperprior</em> is placed on \(\phi\).
  The user can either choose parameter values of a default hyperprior or
  specify their own hyperprior using <code><a href="set_user_prior.html">set_user_prior</a></code>.</p>
<p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code><a href="https://paulnorthrop.github.io/rust/reference/rust-package.html" class="external-link">rust</a></code>
  package is used to draw a random sample from the marginal posterior
  of the hyperparameter vector \(\phi\).
  Then, conditional on these values, population parameters are sampled
  directly from the conditional posterior density of
  \(\theta\)1, ..., \(\theta\)\(I\) given \(\phi\) and the data.
  See the vignette("bang-c-anova-vignette", package = "bang")
  for details.</p>
<p>The following priors are specified up to proportionality.</p>
<p><em>Priors:</em></p>
<p><code>prior = "bda"</code> (the default):
\(\pi(\mu, \sigma_\alpha, \sigma) = 1/\sigma,\)
that is, a uniform prior for \((\mu, \sigma_\alpha, log \sigma)\),
for \(\sigma_\alpha &gt; 0\) and \(\sigma &gt; 0\).
The data must contain at least 3 groups, that is, <code>fac</code> must have
at least 3 levels, for a proper posterior density to be obtained.
[See Sections 5.7 and  11.6 of Gelman et al. (2014).]</p>
<p><code>prior = "unif"</code>:
\(\pi(\mu, \sigma_\alpha, \sigma) = 1,\)
that is, a uniform prior for \((\mu, \sigma_\alpha, \sigma)\),
for \(\sigma_\alpha &gt; 0\) and \(\sigma &gt; 0\).
[See Section 11.6 of Gelman et al. (2014).]</p>
<p><code>prior = "cauchy"</code>: independent half-Cauchy priors for
\(\sigma_\alpha\) and \(\sigma\) with respective scale parameters
\(A_\alpha\) and \(A\), that is,
\(\pi(\sigma_\alpha, \sigma) =
  1 / [(1 + \sigma_\alpha^2 / A_\alpha^2) (1 + \sigma^2 / A^2)].\)
[See Gelman (2006).]  The scale parameters (\(A_\alpha\), \(A\))
are specified using <code>hpars</code> = (\(A_\alpha\), \(A\)).
The default setting is <code>hpars = c(10, 10).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\mu, \sigma_\alpha, \sigma\)),
 <code>param = "trans"</code> (the default) is
  \(\phi1 = \mu, \phi2 = log \sigma_\alpha, \phi3 = log \sigma\).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gelman, A., Carlin, J. B., Stern, H. S. Dunson, D. B.,
 Vehtari, A. and Rubin, D. B. (2014) <em>Bayesian Data Analysis</em>.
 Chapman &amp; Hall / CRC.</p>
<p>Gelman, A. (2006) Prior distributions for variance
  parameters in hierarchical models. <em>Bayesian Analysis</em>,
  <strong>1</strong>(3), 515-533. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">doi:10.1214/06-BA117A</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code><a href="https://paulnorthrop.github.io/rust/reference/rust-package.html" class="external-link">rust</a></code>
  package for details of the arguments that can be passed to <code>ru</code> via
  <code>hanova1</code>.</p>
<p><code><a href="hef.html">hef</a></code> for hierarchical exponential family models.</p>
<p><code><a href="set_user_prior.html">set_user_prior</a></code> to set a user-defined prior.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ======= Late 21st Century Global Temperature Data =======</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract data for RCP2.6</span></span></span>
<span class="r-in"><span><span class="va">RCP26_2</span> <span class="op">&lt;-</span> <span class="va">temp2</span><span class="op">[</span><span class="va">temp2</span><span class="op">$</span><span class="va">RCP</span> <span class="op">==</span> <span class="st">"rcp26"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sample from the posterior under the default `noninformative' flat prior</span></span></span>
<span class="r-in"><span><span class="co"># for (mu, sigma_alpha, log(sigma)).  Ratio-of-uniforms is used to sample</span></span></span>
<span class="r-in"><span><span class="co"># from the marginal posterior for (log(sigma_alpha), log(sigma)).</span></span></span>
<span class="r-in"><span><span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (sigma_alpha, sigma)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"ru"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (log(sigma_alpha), log(sigma))</span></span></span>
<span class="r-in"><span><span class="co"># (centred at (0,0))</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (mu, sigma_alpha, sigma)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimated marginal posterior densities of the mean for each GCM</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, which_pop <span class="op">=</span> <span class="st">"all"</span>, one_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Posterior sample quantiles</span></span></span>
<span class="r-in"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">97.5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">$</span><span class="va">sim_vals</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           1.07 1.19 1.24 1.29  1.41</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha] 0.34 0.40 0.44 0.48  0.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma        0.04 0.05 0.06 0.06  0.07</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Ratio-of-uniforms information and posterior sample summaries</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box         vals1        vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.0000000000  0.000000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -0.1466810 -0.2326509989  0.001997344    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.1475368 -0.0004397794 -0.234538810    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   0.1755008  0.3048045191  0.001126515    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   0.1739269 -0.0010104521  0.300416382    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5353319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mu         sigma[alpha]        sigma        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :0.928   Min.   :0.3074   Min.   :0.03934  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:1.186   1st Qu.:0.3995   1st Qu.:0.05193  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :1.239   Median :0.4377   Median :0.05589  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :1.239   Mean   :0.4450   Mean   :0.05680  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:1.290   3rd Qu.:0.4824   3rd Qu.:0.06093  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :1.542   Max.   :0.7227   Max.   :0.09106  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ======= Coagulation time data, from Table 11.2 Gelman et al (2014) =======</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With only 4 groups the posterior for sigma_alpha has a heavy right tail if</span></span></span>
<span class="r-in"><span><span class="co"># the default `noninformative' flat prior for (mu, sigma_alpha, log(sigma))</span></span></span>
<span class="r-in"><span><span class="co"># is used.  If we try to sample from the marginal posterior for</span></span></span>
<span class="r-in"><span><span class="co"># (sigma_alpha, sigma) using the default generalized ratio-of-uniforms</span></span></span>
<span class="r-in"><span><span class="co"># runing parameter value r = 1/2 then the acceptance region is not bounded.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Two remedies: reparameterize the posterior and/or increase the value of r.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (log(sigma_alpha), log(sigma)) parameterization, ru parameter r = 1/2</span></span></span>
<span class="r-in"><span><span class="va">coag1</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (sigma_alpha, sigma) parameterization, ru parameter r = 1</span></span></span>
<span class="r-in"><span><span class="va">coag2</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               param <span class="op">=</span> <span class="st">"original"</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Values to compare to those in Table 11.3 of Gelman et al (2014)</span></span></span>
<span class="r-in"><span><span class="va">all1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coag1</span><span class="op">$</span><span class="va">theta_sim_vals</span>, <span class="va">coag1</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">all2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coag2</span><span class="op">$</span><span class="va">theta_sim_vals</span>, <span class="va">coag2</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all1</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[1]     58.7 60.4 61.2 62.0  63.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[2]     63.9 65.2 65.8 66.5  67.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[3]     65.9 67.1 67.7 68.4  69.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[4]     59.5 60.6 61.1 61.7  62.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           54.5 62.1 64.1 65.9  75.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha]  1.9  3.7  5.4  8.2  27.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma         1.8  2.2  2.4  2.7   3.4</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all2</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[1]     58.9 60.5 61.3 62.1  63.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[2]     64.0 65.2 65.8 66.6  67.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[3]     65.7 67.1 67.7 68.4  69.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[4]     59.5 60.5 61.1 61.7  62.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           54.1 62.4 64.1 65.7  72.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha]  1.9  3.4  4.9  7.6  28.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma         1.8  2.2  2.4  2.7   3.4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pairwise plots of posterior samples from the group means</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coag1</span>, which_pop <span class="op">=</span> <span class="st">"all"</span>, plot_type <span class="op">=</span> <span class="st">"pairs"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Independent half-Cauchy priors for sigma_alpha and sigma</span></span></span>
<span class="r-in"><span><span class="va">coag3</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 param <span class="op">=</span> <span class="st">"original"</span>, prior <span class="op">=</span> <span class="st">"cauchy"</span>, hpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

