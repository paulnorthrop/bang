<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Posterior sampling for a 1-way hierarchical ANOVA — hanova1 • bang</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Posterior sampling for a 1-way hierarchical ANOVA — hanova1"><meta property="og:description" content="Produces random samples from the posterior distribution of the parameters
of a 1-way hierarchical ANOVA model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a>
    </li>
    <li>
      <a href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a>
    </li>
    <li>
      <a href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a>
    </li>
    <li>
      <a href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/paulnorthrop/bang/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Posterior sampling for a 1-way hierarchical ANOVA</h1>
    <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/bang/blob/HEAD/R/one_way_anova.R" class="external-link"><code>R/one_way_anova.R</code></a></small>
    <div class="hidden name"><code>hanova1.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces random samples from the posterior distribution of the parameters
of a 1-way hierarchical ANOVA model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hanova1</span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="va">resp</span>,</span>
<span>  <span class="va">fac</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  prior <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  hpars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trans"</span>, <span class="st">"original"</span><span class="op">)</span>,</span>
<span>  init <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mu0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  sigma0 <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  nrep <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>n</dt>
<dd><p>A numeric scalar.  The size of posterior sample required.</p></dd>


<dt>resp</dt>
<dd><p>A numeric vector.  Response values.</p></dd>


<dt>fac</dt>
<dd><p>A vector of class <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></code> indicating the group from
which the corresponding element of <code>resp</code> originates.
Must have the same length as <code>resp</code>.</p></dd>


<dt>...</dt>
<dd><p>Optional further arguments to be passed to
<code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.</p></dd>


<dt>prior</dt>
<dd><p>The log-prior for the parameters of the hyperprior
distribution.  If the user wishes to specify their own prior then
<code>prior</code> must be an object returned from a call to
<code><a href="set_user_prior.html">set_user_prior</a></code>.
Otherwise, <code>prior</code> is a character scalar giving the name of the
required in-built prior.
If <code>prior</code> is not supplied then a default prior is used.
See <strong>Details</strong>.</p></dd>


<dt>hpars</dt>
<dd><p>A numeric vector.  Used to set parameters (if any) in
an in-built prior.  If <code>prior = cauchy</code> then <code>hpars</code> is
a numeric vector of length 2 giving the respective scale parameters
of the half-Cauchy priors for \(\sigma_\alpha\) and \(\sigma\).</p></dd>


<dt>param</dt>
<dd><p>A character scalar.
If <code>param = "trans"</code> (the default) then the marginal posterior
of hyperparameter vector \(\phi\) is reparameterized in terms of
\(log \sigma_\alpha, log \sigma\).
If <code>param = "original"</code> the original parameterization,
i.e. \(\sigma_\alpha, \sigma\) is used.
The former tends to make the optimizations involved in the
ratio-of-uniforms algorithm more stable and to increase the probability
of acceptance, but at the expense of slower function evaluations.</p></dd>


<dt>init</dt>
<dd><p>A numeric vector. Optional initial estimates sent to
<code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> in the search for the mode of the posterior
density of (perhaps a subset of) the hyperparameter vector \(\phi\).
If an in-built prior is used then <code>ru</code> is used to sample from the
marginal posterior density of \((\sigma_\alpha, \sigma)\), so
<code>init</code> must have length 2.  Otherwise, <code>init</code> has length
equal to the argument <code>anova_d</code> supplied to
<code><a href="set_user_prior.html">set_user_prior</a></code>.</p></dd>


<dt>mu0, sigma0</dt>
<dd><p>A numeric scalar.  Mean and standard deviation of a
normal prior for \(\mu\).  Only used if an in-built prior is used
or if <code>anova_d = 2</code> is supplied in a call to
<code><a href="set_user_prior.html">set_user_prior</a></code> to set a user-defined prior.
The default, <code>sigma0 = Inf</code>, sets an improper uniform prior
for \(\mu\).</p></dd>


<dt>nrep</dt>
<dd><p>A numeric scalar.  If <code>nrep</code> is not <code>NULL</code> then
<code>nrep</code> gives the number of replications of the original dataset
simulated from the posterior predictive distribution.
Each replication is based on one of the samples from the posterior
distribution.  Therefore, <code>nrep</code> must not be greater than <code>n</code>.
In that event <code>nrep</code> is set equal to <code>n</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object (list) of class <code>"hef"</code>, which has the same
  structure as an object of class "ru" returned from <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.
  In particular, the columns of the <code>n</code>-row matrix <code>sim_vals</code></p>


<p>contain the simulated values of \(\phi\).
  In addition this list contains the arguments <code>model</code>, <code>resp</code>,</p>
<p></p>
<p><code>fac</code> and <code>prior</code> detailed above and an <code>n</code> by \(I\)</p>


<p>matrix <code>theta_sim_vals</code>: column \(i\) contains the simulated
  values of  \(\theta\)\(i\).  Also included are</p>
<p></p>
<p><code>data = cbind(resp, fac)</code> and <code>summary_stats</code> a list
  containing: the number of groups <code>I</code>; the numbers of responses
  each group <code>ni</code>; the total number of observations; the sample mean
  response in each group; the sum of squared deviations from the
  group means <code>s</code>; the arguments to <code>hanova1</code></p>
<p></p>
<p><code>mu0</code> and</p>
<p></p>
<p><code>sigma0</code>; <code>call</code>: the matched call to <code>hanova1</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Consider \(I\) independent experiments in which the \(ni\) responses
  <strong>\(y\)</strong>\(i\) from experiment/group \(i\) are normally
  distributed with mean \(\theta i\) and standard deviation \(\sigma\).
  The population parameters \(\theta\)1, ...,
  \(\theta\)\(I\) are modelled as random samples from a normal
  distribution with mean \(\mu\) and standard deviation
  \(\sigma_\alpha\).  Let \(\phi = (\mu, \sigma_\alpha, \sigma)\).
  Conditionally on \(\theta\)1, ..., \(\theta\)\(I\),
  <strong>\(y\)</strong>1, ..., <strong>\(y\)</strong>\(I\)
  are independent of each other and are independent of \(\phi\).
  A <em>hyperprior</em> is placed on \(\phi\).
  The user can either choose parameter values of a default hyperprior or
  specify their own hyperprior using <code><a href="set_user_prior.html">set_user_prior</a></code>.</p>
<p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code><a href="https://paulnorthrop.github.io/rust/reference/rust-package.html" class="external-link">rust</a></code>
  package is used to draw a random sample from the marginal posterior
  of the hyperparameter vector \(\phi\).
  Then, conditional on these values, population parameters are sampled
  directly from the conditional posterior density of
  \(\theta\)1, ..., \(\theta\)\(I\) given \(\phi\) and the data.
  See the vignette("bang-c-anova-vignette", package = "bang")
  for details.</p>
<p>The following priors are specified up to proportionality.</p>
<p><em>Priors:</em></p>
<p><code>prior = "bda"</code> (the default):
\(\pi(\mu, \sigma_\alpha, \sigma) = 1/\sigma,\)
that is, a uniform prior for \((\mu, \sigma_\alpha, log \sigma)\),
for \(\sigma_\alpha &gt; 0\) and \(\sigma &gt; 0\).
The data must contain at least 3 groups, that is, <code>fac</code> must have
at least 3 levels, for a proper posterior density to be obtained.
[See Sections 5.7 and  11.6 of Gelman et al. (2014).]</p>
<p><code>prior = "unif"</code>:
\(\pi(\mu, \sigma_\alpha, \sigma) = 1,\)
that is, a uniform prior for \((\mu, \sigma_\alpha, \sigma)\),
for \(\sigma_\alpha &gt; 0\) and \(\sigma &gt; 0\).
[See Section 11.6 of Gelman et al. (2014).]</p>
<p><code>prior = "cauchy"</code>: independent half-Cauchy priors for
\(\sigma_\alpha\) and \(\sigma\) with respective scale parameters
\(A_\alpha\) and \(A\), that is,
\(\pi(\sigma_\alpha, \sigma) =
  1 / [(1 + \sigma_\alpha^2 / A_\alpha^2) (1 + \sigma^2 / A^2)].\)
[See Gelman (2006).]  The scale parameters (\(A_\alpha\), \(A\))
are specified using <code>hpars</code> = (\(A_\alpha\), \(A\)).
The default setting is <code>hpars = c(10, 10).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\mu, \sigma_\alpha, \sigma\)),
 <code>param = "trans"</code> (the default) is
  \(\phi1 = \mu, \phi2 = log \sigma_\alpha, \phi3 = log \sigma\).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gelman, A., Carlin, J. B., Stern, H. S. Dunson, D. B.,
 Vehtari, A. and Rubin, D. B. (2014) <em>Bayesian Data Analysis</em>.
 Chapman &amp; Hall / CRC.</p>
<p>Gelman, A. (2006) Prior distributions for variance
  parameters in hierarchical models. <em>Bayesian Analysis</em>,
  <strong>1</strong>(3), 515-533. <a href="https://doi.org/10.1214/06-BA117A" class="external-link">doi:10.1214/06-BA117A</a>
.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code><a href="https://paulnorthrop.github.io/rust/reference/rust-package.html" class="external-link">rust</a></code>
  package for details of the arguments that can be passed to <code>ru</code> via
  <code>hanova1</code>.</p>
<p><code><a href="hef.html">hef</a></code> for hierarchical exponential family models.</p>
<p><code><a href="set_user_prior.html">set_user_prior</a></code> to set a user-defined prior.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ======= Late 21st Century Global Temperature Data =======</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract data for RCP2.6</span></span></span>
<span class="r-in"><span><span class="va">RCP26_2</span> <span class="op">&lt;-</span> <span class="va">temp2</span><span class="op">[</span><span class="va">temp2</span><span class="op">$</span><span class="va">RCP</span> <span class="op">==</span> <span class="st">"rcp26"</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sample from the posterior under the default `noninformative' flat prior</span></span></span>
<span class="r-in"><span><span class="co"># for (mu, sigma_alpha, log(sigma)).  Ratio-of-uniforms is used to sample</span></span></span>
<span class="r-in"><span><span class="co"># from the marginal posterior for (log(sigma_alpha), log(sigma)).</span></span></span>
<span class="r-in"><span><span class="va">temp_res</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">RCP26_2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (sigma_alpha, sigma)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"ru"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (log(sigma_alpha), log(sigma))</span></span></span>
<span class="r-in"><span><span class="co"># (centred at (0,0))</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot of sampled values of (mu, sigma_alpha, sigma)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Estimated marginal posterior densities of the mean for each GCM</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">temp_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, which_pop <span class="op">=</span> <span class="st">"all"</span>, one_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Posterior sample quantiles</span></span></span>
<span class="r-in"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">97.5</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">$</span><span class="va">sim_vals</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           1.07 1.19 1.24 1.30  1.40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha] 0.34 0.40 0.43 0.49  0.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma        0.04 0.05 0.06 0.06  0.07</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Ratio-of-uniforms information and posterior sample summaries</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">temp_res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box         vals1        vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.0000000000  0.000000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -0.1466810 -0.2326509989  0.001997344    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.1475368 -0.0004397794 -0.234538810    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   0.1755008  0.3048045191  0.001126515    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   0.1739269 -0.0010104521  0.300416382    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5473454</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mu          sigma[alpha]        sigma        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :0.9404   Min.   :0.2808   Min.   :0.03864  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:1.1881   1st Qu.:0.3983   1st Qu.:0.05182  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :1.2392   Median :0.4350   Median :0.05650  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :1.2415   Mean   :0.4464   Mean   :0.05721  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:1.2994   3rd Qu.:0.4871   3rd Qu.:0.06195  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :1.5743   Max.   :0.6859   Max.   :0.09005  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ======= Coagulation time data, from Table 11.2 Gelman et al (2014) =======</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With only 4 groups the posterior for sigma_alpha has a heavy right tail if</span></span></span>
<span class="r-in"><span><span class="co"># the default `noninformative' flat prior for (mu, sigma_alpha, log(sigma))</span></span></span>
<span class="r-in"><span><span class="co"># is used.  If we try to sample from the marginal posterior for</span></span></span>
<span class="r-in"><span><span class="co"># (sigma_alpha, sigma) using the default generalized ratio-of-uniforms</span></span></span>
<span class="r-in"><span><span class="co"># runing parameter value r = 1/2 then the acceptance region is not bounded.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Two remedies: reparameterize the posterior and/or increase the value of r.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (log(sigma_alpha), log(sigma)) parameterization, ru parameter r = 1/2</span></span></span>
<span class="r-in"><span><span class="va">coag1</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (sigma_alpha, sigma) parameterization, ru parameter r = 1</span></span></span>
<span class="r-in"><span><span class="va">coag2</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>               param <span class="op">=</span> <span class="st">"original"</span>, r <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Values to compare to those in Table 11.3 of Gelman et al (2014)</span></span></span>
<span class="r-in"><span><span class="va">all1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coag1</span><span class="op">$</span><span class="va">theta_sim_vals</span>, <span class="va">coag1</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">all2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coag2</span><span class="op">$</span><span class="va">theta_sim_vals</span>, <span class="va">coag2</span><span class="op">$</span><span class="va">sim_vals</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all1</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[1]     58.6 60.4 61.2 62.0  63.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[2]     63.8 65.2 65.8 66.5  68.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[3]     65.8 67.1 67.7 68.4  69.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[4]     59.3 60.6 61.1 61.7  63.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           55.5 62.3 63.9 65.6  72.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha]  2.0  3.6  5.1  8.1  25.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma         1.8  2.2  2.4  2.7   3.5</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">all2</span>, <span class="fl">2</span>, <span class="va">quantile</span>, probs <span class="op">=</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              2.5%  25%  50%  75% 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[1]     58.7 60.5 61.3 62.1  63.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[2]     63.9 65.2 65.9 66.5  67.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[3]     65.8 67.1 67.8 68.4  69.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta[4]     59.4 60.6 61.1 61.7  62.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mu           55.4 62.1 63.9 65.8  73.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma[alpha]  1.9  3.4  4.9  7.5  23.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma         1.8  2.2  2.4  2.7   3.4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Pairwise plots of posterior samples from the group means</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">coag1</span>, which_pop <span class="op">=</span> <span class="st">"all"</span>, plot_type <span class="op">=</span> <span class="st">"pairs"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="hanova1-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Independent half-Cauchy priors for sigma_alpha and sigma</span></span></span>
<span class="r-in"><span><span class="va">coag3</span> <span class="op">&lt;-</span> <span class="fu">hanova1</span><span class="op">(</span>resp <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, fac <span class="op">=</span> <span class="va">coagulation</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                 param <span class="op">=</span> <span class="st">"original"</span>, prior <span class="op">=</span> <span class="st">"cauchy"</span>, hpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

