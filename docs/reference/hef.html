<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Hierarchical Exponential Family Model — hef • bang</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Hierarchical Exponential Family Model — hef" />
<meta property="og:description" content="Produces random samples from the posterior distribution of the parameters
of certain hierarchical exponential family models." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a>
    </li>
    <li>
      <a href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a>
    </li>
    <li>
      <a href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a>
    </li>
    <li>
      <a href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/paulnorthrop/bang">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Hierarchical Exponential Family Model</h1>
    <small class="dont-index">Source: <a href='https://github.com/paulnorthrop/bang/blob/master/R/hef.R'><code>R/hef.R</code></a></small>
    <div class="hidden name"><code>hef.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces random samples from the posterior distribution of the parameters
of certain hierarchical exponential family models.</p>
    </div>

    <pre class="usage"><span class='fu'>hef</span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"beta_binom"</span>, <span class='st'>"gamma_pois"</span>), <span class='no'>data</span>, <span class='no'>...</span>,
  <span class='kw'>prior</span> <span class='kw'>=</span> <span class='st'>"default"</span>, <span class='kw'>hpars</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>param</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"trans"</span>, <span class='st'>"original"</span>),
  <span class='kw'>init</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>nrep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>n</th>
      <td><p>An integer scalar.  The size of the posterior sample required.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>A character string.  Abbreviated name for the
response-population distribution combination.
For a hierarchical normal model see <code><a href='hanova1.html'>hanova1</a></code>
(hierarchical one-way analysis of variance (ANOVA)).</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A numeric matrix.  The format depends on <code>model</code>.
See <strong>Details</strong>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Optional further arguments to be passed to
<code><a href='https://rdrr.io/pkg/rust/man/ru.html'>ru</a></code>.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>The log-prior for the parameters of the hyperprior
distribution.  If the user wishes to specify their own prior then
<code>prior</code> must be an object returned from a call to
<code><a href='set_user_prior.html'>set_user_prior</a></code>.
Otherwise, <code>prior</code> is a character scalar giving the name of the
required in-built prior.
If <code>prior</code> is not supplied then a default prior is used.
See <strong>Details</strong>.</p></td>
    </tr>
    <tr>
      <th>hpars</th>
      <td><p>A numeric vector.  Used to set parameters (if any) in
an in-built prior.</p></td>
    </tr>
    <tr>
      <th>param</th>
      <td><p>A character scalar.
If <code>param = "trans"</code> (the default) then the marginal posterior
of hyperparameter vector \(\phi\) is reparameterized in a way
designed to improve the efficiency of sampling from this posterior.
If <code>param = "original"</code> the original parameterization is used.
The former tends to make the optimizations involved in the
ratio-of-uniforms algorithm more stable and to increase the probability
of acceptance, but at the expense of slower function evaluations.</p></td>
    </tr>
    <tr>
      <th>init</th>
      <td><p>A numeric vector of length 2.  Optional initial estimates
for the search for the mode of the posterior density of the
hyperparameter vector \(\phi\).</p></td>
    </tr>
    <tr>
      <th>nrep</th>
      <td><p>A numeric scalar.  If <code>nrep</code> is not <code>NULL</code> then
<code>nrep</code> gives the number of replications of the original dataset
simulated from the posterior predictive distribution.
Each replication is based on one of the samples from the posterior
distribution.  Therefore, <code>nrep</code> must not be greater than <code>n</code>.
In that event <code>nrep</code> is set equal to <code>n</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object (list) of class <code>"hef"</code>, which has the same
  structure as an object of class "ru" returned from <code><a href='https://rdrr.io/pkg/rust/man/ru.html'>ru</a></code>.
  In particular, the columns of the <code>n</code>-row matrix <code>sim_vals</code>
  contain the simulated values of \(\phi\).
  In addition this list contains the arguments <code>model</code>, <code>data</code>
  and <code>prior</code> detailed above, an <code>n</code> by \(J\) matrix
  <code>theta_sim_vals</code>: column \(j\) contains the simulated values of
  \(\theta\)\(j\) and <code>call</code>: the matched call to <code>hef</code>.</p>
<p>If <code>nrep</code> is not <code>NULL</code> then this list also contains
  <code>data_rep</code>, a numerical matrix with <code>nrep</code> columns.
  Each column contains a replication of the first column of the original
  data <code>data[, 1]</code>, simulated from the posterior predictive
  distribution.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Conditional on population-specific parameter vectors
  \(\theta\)1, ..., \(\theta\)\(J\)
  the observed <em>response</em> data \(y\)1, ..., \(y\)J within each
  population are modelled as random samples from a distribution in an
  exponential family. The population parameters \(\theta\)1, ...,
  \(\theta\)\(J\) are modelled as random samples from a common
  <em>population distribution</em>, chosen to be conditionally conjugate
  to the response distribution, with <em>hyperparameter</em> vector
  \(\phi\).  Conditionally on
  \(\theta\)1, ..., \(\theta\)\(J\), \(y\)1, ..., \(y\)\(J\)
  are independent of each other and are independent of \(\phi\).
  A <em>hyperprior</em> is placed on \(\phi\).  The user can either
  choose parameter values of a default hyperprior or specify their own
  hyperprior using <code><a href='set_user_prior.html'>set_user_prior</a></code>.</p>
<p>The <code><a href='https://rdrr.io/pkg/rust/man/ru.html'>ru</a></code> function in the <code><a href='https://rdrr.io/pkg/rust/man/rust.html'>rust</a></code>
  package is used to draw a random sample
  from the marginal posterior of the hyperparameter vector \(\phi\).
  Then, conditional on these values, population parameters are sampled
  directly from the conditional posterior density of
  \(\theta\)1, ..., \(\theta\)\(J\) given \(\phi\) and the data.</p>
<p>We outline each <code>model</code>, specify the format of the
  <code>data</code>, give the default (log-)priors (up to an additive constant)
  and detail the choices of ratio-of-uniforms parameterization
  <code>param</code>.</p>
<p><strong>Beta-binomial:</strong> For \(j = 1, ..., J\),
  \(Yj | pj\) are i.i.d binomial\((nj, pj)\),
  where \(pj\) is the probability of success in group \(j\)
  and \(nj\) is the number of trials in group \(j\).
  \(pj\) are i.i.d. beta\((\alpha, \beta)\), so
  and \(\phi = (\alpha, \beta)\).
  <code>data</code> is a 2-column matrix: the numbers of successes in column 1
  and the corresponding numbers of trials in column 2.</p>
<p><em>Priors:</em></p>
<p><code>prior = "bda"</code> (the default):
\(log \pi(\alpha, \beta) = - 2.5 log(\alpha + \beta),
  \alpha &gt; 0, \beta &gt; 0.\) [See Section 5.3 of Gelman et al. (2014).]</p>
<p><code>prior = "gamma"</code>: independent gamma priors on \(\alpha\)
and \(\beta\), i.e.
\(log \pi(\alpha, \beta) =
  (s1 - 1)log\alpha - r1 \alpha +
  (s2 - 1)log\beta - r2 \beta,  \alpha &gt; 0, \beta &gt; 0.\)
where the respective shape (\(s1\), \(s2\)) and rate
(\(r1\), \(r2\)) parameters are specified using
<code>hpars</code> = \((s1, r1, s2, r2)\).  The default setting is
<code>hpars = c(1, 0.01, 1, 0.01).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\alpha, \beta\)),
 <code>param = "trans"</code> (the default) is
\(\phi1 = logit(\alpha/(\alpha+\beta)) = log(\alpha/\beta),
  \phi2 = log(\alpha+\beta)\).
See Section 5.3 of Gelman et al. (2014).</p>
<p><strong>Gamma-Poisson:</strong> For \(j = 1, ..., J\),
  \(Yj | \lambda\)j are i.i.d Poisson(\(e\)j\(\lambda\)j),
  where
  \(ej\) is the <em>exposure</em> in group \(j\), based on the
  total length of observation time and/or size of the population at
  risk of the event of interest and \(\lambda\)j is the mean number
  of events per unit of exposure.
  \(\lambda\)j are i.i.d. gamma\((\alpha, \beta)\), so
  \(\phi = (\alpha, \beta)\).
  <code>data</code> is a 2-column matrix: the counts \(yj\) of the numbers of
  events in column 1 and the corresponding exposures \(ej\) in column 2.</p>
<p><em>Priors:</em></p>
<p><code>prior = "gamma"</code> (the default): independent gamma priors
  on \(\alpha\) and \(\beta\), i.e.
\(log \pi(\alpha, \beta) =
  (s1 - 1)log\alpha - r1 \alpha +
  (s2 - 1)log\beta - r2 \beta,  \alpha &gt; 0, \beta &gt; 0.\)
where the respective shape (\(s1\), \(s2\)) and rate
(\(r1\), \(r2\)) parameters are specified using
<code>hpars</code> = \((s1, r1, s2, r2)\).  The default setting is
<code>hpars = c(1, 0.01, 1, 0.01).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\alpha, \beta\)),
 <code>param = "trans"</code> (the default) is
\(\phi1 = log(\alpha/\beta), \phi2 = log(\beta).\)</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Gelman, A., Carlin, J. B., Stern, H. S. Dunson, D. B.,
 Vehtari, A. and Rubin, D. B. (2014) <em>Bayesian Data Analysis</em>.
 Chapman &amp; Hall / CRC.
  <a href='http://www.stat.columbia.edu/~gelman/book'>http://www.stat.columbia.edu/~gelman/book</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>The <code><a href='https://rdrr.io/pkg/rust/man/ru.html'>ru</a></code> function in the <code>rust</code>
  package for details of the arguments that can be passed to <code>ru</code> via
  <code>hef</code>.</p>
<p><code><a href='hanova1.html'>hanova1</a></code> for hierarchical one-way analysis of
  variance (ANOVA).</p>
<p><code><a href='set_user_prior.html'>set_user_prior</a></code> to set a user-defined prior.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>############################ Beta-binomial #################################</span>

<span class='co'># ------------------------- Rat tumor data ------------------------------- #</span>

<span class='co'># Default prior, sampling on (rotated) (log(mean), log(alpha + beta)) scale</span>
<span class='no'>rat_res</span> <span class='kw'>&lt;-</span> <span class='fu'>hef</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"beta_binom"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>rat</span>)
<span class='co'># \donttest{</span>
<span class='co'># Hyperparameters alpha and beta</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>)</div><div class='img'><img src='hef-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Parameterization used for sampling</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>, <span class='kw'>ru_scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='hef-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>rat_res</span>)</div><div class='output co'>#&gt; ru bounding box:  
#&gt;                box       vals1       vals2 conv
#&gt; a        1.0000000  0.00000000  0.00000000    0
#&gt; b1minus -0.2382163 -0.40313465 -0.03906170    0
#&gt; b2minus -0.2174510  0.05447431 -0.35297539    0
#&gt; b1plus   0.2231876  0.36718411 -0.06551353    0
#&gt; b2plus   0.2512577  0.05665707  0.44459818    0
#&gt; 
#&gt; estimated probability of acceptance:  
#&gt; [1] 0.5194805
#&gt; 
#&gt; sample summary 
#&gt;      alpha              beta       
#&gt;  Min.   : 0.8536   Min.   : 5.064  
#&gt;  1st Qu.: 1.7943   1st Qu.:10.800  
#&gt;  Median : 2.2262   Median :13.646  
#&gt;  Mean   : 2.4495   Mean   :14.678  
#&gt;  3rd Qu.: 2.8735   3rd Qu.:17.155  
#&gt;  Max.   :13.2346   Max.   :76.543  </div><div class='input'>
<span class='co'># Choose rats with extreme sample probabilities</span>
<span class='no'>pops</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span>(<span class='no'>rat</span>[, <span class='fl'>1</span>] / <span class='no'>rat</span>[, <span class='fl'>2</span>]), <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span>(<span class='no'>rat</span>[, <span class='fl'>1</span>] / <span class='no'>rat</span>[, <span class='fl'>2</span>]))
<span class='co'># Population-specific posterior samples: separate plots</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='st'>"pop"</span>, <span class='kw'>plot_type</span> <span class='kw'>=</span> <span class='st'>"both"</span>, <span class='kw'>which_pop</span> <span class='kw'>=</span> <span class='no'>pops</span>)</div><div class='img'><img src='hef-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Population-specific posterior samples: one plot</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='st'>"pop"</span>, <span class='kw'>plot_type</span> <span class='kw'>=</span> <span class='st'>"dens"</span>, <span class='kw'>which_pop</span> <span class='kw'>=</span> <span class='no'>pops</span>,
     <span class='kw'>one_plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>add_legend</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='hef-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Default prior, sampling on (rotated) (alpha, beta) scale</span>
<span class='no'>rat_res</span> <span class='kw'>&lt;-</span> <span class='fu'>hef</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"beta_binom"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>rat</span>, <span class='kw'>param</span> <span class='kw'>=</span> <span class='st'>"original"</span>)
<span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>)</div><div class='img'><img src='hef-5.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>, <span class='kw'>ru_scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='hef-6.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>rat_res</span>)</div><div class='output co'>#&gt; ru bounding box:  
#&gt;                box       vals1      vals2 conv
#&gt; a        1.0000000  0.00000000  0.0000000    0
#&gt; b1minus -1.0464012 -1.85116847  0.8473716    0
#&gt; b2minus -0.7515215  0.06414713 -1.0929862    0
#&gt; b1plus   1.2453108  2.53614928  1.3267447    0
#&gt; b2plus   1.6246189  0.52814754  3.8051940    0
#&gt; 
#&gt; estimated probability of acceptance:  
#&gt; [1] 0.4761905
#&gt; 
#&gt; sample summary 
#&gt;      alpha            beta      
#&gt;  Min.   :0.883   Min.   : 5.32  
#&gt;  1st Qu.:1.761   1st Qu.:10.54  
#&gt;  Median :2.220   Median :13.36  
#&gt;  Mean   :2.388   Mean   :14.27  
#&gt;  3rd Qu.:2.799   3rd Qu.:16.83  
#&gt;  Max.   :7.281   Max.   :44.10  </div><div class='input'>
<span class='co'># To produce a plot akin to Figure 5.3 of Gelman et al. (2014) we</span>
<span class='co'># (a) Use the same prior for (alpha, beta)</span>
<span class='co'># (b) Don't use axis rotation (rotate = FALSE)</span>
<span class='co'># (c) Plot on the scale used for ratio-of-uniforms sampling (ru_scale = TRUE)</span>
<span class='co'># (d) Note that the mode is relocated to (0, 0) in the plot</span>
<span class='no'>rat_res</span> <span class='kw'>&lt;-</span> <span class='fu'>hef</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"beta_binom"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>rat</span>, <span class='kw'>rotate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>, <span class='kw'>ru_scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='hef-7.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># This is the estimated location of the posterior mode</span>
<span class='no'>rat_res</span>$<span class='no'>f_mode</span></div><div class='output co'>#&gt; [1] -1.785783  2.741549</div><div class='input'>
<span class='co'># User-defined prior, passing parameters</span>
<span class='co'># (equivalent to prior = "gamma" with hpars = c(1, 0.01, 1, 0.01))</span>
<span class='no'>user_prior</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>hpars</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/function.html'>return</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>dexp</a></span>(<span class='no'>x</span>[<span class='fl'>1</span>], <span class='no'>hpars</span>[<span class='fl'>1</span>], <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>) + <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>dexp</a></span>(<span class='no'>x</span>[<span class='fl'>2</span>], <span class='no'>hpars</span>[<span class='fl'>2</span>], <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
}
<span class='no'>user_prior_fn</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='set_user_prior.html'>set_user_prior</a></span>(<span class='no'>user_prior</span>, <span class='kw'>hpars</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.01</span>, <span class='fl'>0.01</span>))
<span class='no'>rat_res</span> <span class='kw'>&lt;-</span> <span class='fu'>hef</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"beta_binom"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>rat</span>, <span class='kw'>prior</span> <span class='kw'>=</span> <span class='no'>user_prior_fn</span>)
<span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>rat_res</span>)</div><div class='img'><img src='hef-8.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>rat_res</span>)</div><div class='output co'>#&gt; ru bounding box:  
#&gt;                box       vals1       vals2 conv
#&gt; a        1.0000000  0.00000000  0.00000000    0
#&gt; b1minus -0.2425978 -0.41087097 -0.04439263    0
#&gt; b2minus -0.2145118  0.05190271 -0.34376799    0
#&gt; b1plus   0.2280150  0.37607515 -0.07085000    0
#&gt; b2plus   0.2730012  0.06004980  0.51162996    0
#&gt; 
#&gt; estimated probability of acceptance:  
#&gt; [1] 0.5208333
#&gt; 
#&gt; sample summary 
#&gt;      alpha             beta       
#&gt;  Min.   : 1.034   Min.   : 7.039  
#&gt;  1st Qu.: 2.280   1st Qu.:13.740  
#&gt;  Median : 2.930   Median :17.441  
#&gt;  Mean   : 3.182   Mean   :19.082  
#&gt;  3rd Qu.: 3.746   3rd Qu.:22.565  
#&gt;  Max.   :10.487   Max.   :57.031  </div><div class='input'>
<span class='co'>############################ Gamma-Poisson #################################</span>

<span class='co'># ------------------------ Pump failure data ------------------------------ #</span>

<span class='no'>pump_res</span> <span class='kw'>&lt;-</span> <span class='fu'>hef</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='st'>"gamma_pois"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>pump</span>)
<span class='co'># Hyperparameters alpha and beta</span>
<span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pump_res</span>)</div><div class='img'><img src='hef-9.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }</span>
<span class='co'># Parameterization used for sampling</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pump_res</span>, <span class='kw'>ru_scale</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='hef-10.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>pump_res</span>)</div><div class='output co'>#&gt; ru bounding box:  
#&gt;                box       vals1       vals2 conv
#&gt; a        1.0000000  0.00000000  0.00000000    0
#&gt; b1minus -0.5174980 -0.91869101 -0.06060116    0
#&gt; b2minus -0.5150835  0.15757254 -0.92429417    0
#&gt; b1plus   0.4124640  0.65433383 -0.11046433    0
#&gt; b2plus   0.4224941  0.08788857  0.67847965    0
#&gt; 
#&gt; estimated probability of acceptance:  
#&gt; [1] 0.5136107
#&gt; 
#&gt; sample summary 
#&gt;      alpha             beta       
#&gt;  Min.   :0.2271   Min.   :0.2641  
#&gt;  1st Qu.:0.8036   1st Qu.:1.2776  
#&gt;  Median :1.0741   Median :1.9060  
#&gt;  Mean   :1.1493   Mean   :2.1830  
#&gt;  3rd Qu.:1.4325   3rd Qu.:2.7548  
#&gt;  Max.   :4.8299   Max.   :8.7179  </div><div class='input'>
<span class='co'># Choose pumps with extreme sample rates</span>
<span class='no'>pops</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span>(<span class='no'>pump</span>[, <span class='fl'>1</span>] / <span class='no'>pump</span>[, <span class='fl'>2</span>]), <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.max</a></span>(<span class='no'>pump</span>[, <span class='fl'>1</span>] / <span class='no'>pump</span>[, <span class='fl'>2</span>]))
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>pump_res</span>, <span class='kw'>params</span> <span class='kw'>=</span> <span class='st'>"pop"</span>, <span class='kw'>plot_type</span> <span class='kw'>=</span> <span class='st'>"dens"</span>, <span class='kw'>which_pop</span> <span class='kw'>=</span> <span class='no'>pops</span>)</div><div class='img'><img src='hef-11.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


