<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hierarchical Exponential Family Model — hef • bang</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Exponential Family Model — hef"><meta property="og:description" content="Produces random samples from the posterior distribution of the parameters
of certain hierarchical exponential family models."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/bang-a-vignette.html">Introducing bang: Bayesian Analysis, No Gibbs</a>
    </li>
    <li>
      <a href="../articles/bang-b-hef-vignette.html">Conjugate Hierarchical Models</a>
    </li>
    <li>
      <a href="../articles/bang-c-anova-vignette.html">Hierarchical 1-way Analysis of Variance</a>
    </li>
    <li>
      <a href="../articles/bang-d-ppc-vignette.html">Posterior Predictive Checking</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/paulnorthrop/bang/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Hierarchical Exponential Family Model</h1>
    <small class="dont-index">Source: <a href="http://github.com/paulnorthrop/bang/blob/HEAD/R/hef.R" class="external-link"><code>R/hef.R</code></a></small>
    <div class="hidden name"><code>hef.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Produces random samples from the posterior distribution of the parameters
of certain hierarchical exponential family models.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">hef</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta_binom"</span>, <span class="st">"gamma_pois"</span><span class="op">)</span>, <span class="va">data</span>, <span class="va">...</span>,
  prior <span class="op">=</span> <span class="st">"default"</span>, hpars <span class="op">=</span> <span class="cn">NULL</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trans"</span>, <span class="st">"original"</span><span class="op">)</span>,
  init <span class="op">=</span> <span class="cn">NULL</span>, nrep <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>n</dt>
<dd><p>An integer scalar.  The size of the posterior sample required.</p></dd>
<dt>model</dt>
<dd><p>A character string.  Abbreviated name for the
response-population distribution combination.
For a hierarchical normal model see <code><a href="hanova1.html">hanova1</a></code>
(hierarchical one-way analysis of variance (ANOVA)).</p></dd>
<dt>data</dt>
<dd><p>A numeric matrix.  The format depends on <code>model</code>.
See <strong>Details</strong>.</p></dd>
<dt>...</dt>
<dd><p>Optional further arguments to be passed to
<code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.</p></dd>
<dt>prior</dt>
<dd><p>The log-prior for the parameters of the hyperprior
distribution.  If the user wishes to specify their own prior then
<code>prior</code> must be an object returned from a call to
<code><a href="set_user_prior.html">set_user_prior</a></code>.
Otherwise, <code>prior</code> is a character scalar giving the name of the
required in-built prior.
If <code>prior</code> is not supplied then a default prior is used.
See <strong>Details</strong>.</p></dd>
<dt>hpars</dt>
<dd><p>A numeric vector.  Used to set parameters (if any) in
an in-built prior.</p></dd>
<dt>param</dt>
<dd><p>A character scalar.
If <code>param = "trans"</code> (the default) then the marginal posterior
of hyperparameter vector \(\phi\) is reparameterized in a way
designed to improve the efficiency of sampling from this posterior.
If <code>param = "original"</code> the original parameterization is used.
The former tends to make the optimizations involved in the
ratio-of-uniforms algorithm more stable and to increase the probability
of acceptance, but at the expense of slower function evaluations.</p></dd>
<dt>init</dt>
<dd><p>A numeric vector of length 2.  Optional initial estimates
for the search for the mode of the posterior density of the
hyperparameter vector \(\phi\).</p></dd>
<dt>nrep</dt>
<dd><p>A numeric scalar.  If <code>nrep</code> is not <code>NULL</code> then
<code>nrep</code> gives the number of replications of the original dataset
simulated from the posterior predictive distribution.
Each replication is based on one of the samples from the posterior
distribution.  Therefore, <code>nrep</code> must not be greater than <code>n</code>.
In that event <code>nrep</code> is set equal to <code>n</code>.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object (list) of class <code>"hef"</code>, which has the same
  structure as an object of class "ru" returned from <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code>.
  In particular, the columns of the <code>n</code>-row matrix <code>sim_vals</code>  contain the simulated values of \(\phi\).
  In addition this list contains the arguments <code>model</code>, <code>data</code>  and <code>prior</code> detailed above, an <code>n</code> by \(J\) matrix
<code>theta_sim_vals</code>: column \(j\) contains the simulated values of
\(\theta\)\(j\) and <code>call</code>: the matched call to <code>hef</code>.
  If <code>nrep</code> is not <code>NULL</code> then this list also contains
<code>data_rep</code>, a numerical matrix with <code>nrep</code> columns.
  Each column contains a replication of the first column of the original
  data <code>data[, 1]</code>, simulated from the posterior predictive
  distribution.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Conditional on population-specific parameter vectors
  \(\theta\)1, ..., \(\theta\)\(J\)
  the observed <em>response</em> data \(y\)1, ..., \(y\)J within each
  population are modelled as random samples from a distribution in an
  exponential family. The population parameters \(\theta\)1, ...,
  \(\theta\)\(J\) are modelled as random samples from a common
  <em>population distribution</em>, chosen to be conditionally conjugate
  to the response distribution, with <em>hyperparameter</em> vector
  \(\phi\).  Conditionally on
  \(\theta\)1, ..., \(\theta\)\(J\), \(y\)1, ..., \(y\)\(J\)
  are independent of each other and are independent of \(\phi\).
  A <em>hyperprior</em> is placed on \(\phi\).  The user can either
  choose parameter values of a default hyperprior or specify their own
  hyperprior using <code><a href="set_user_prior.html">set_user_prior</a></code>.</p>
<p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code><a href="https://paulnorthrop.github.io/rust/reference/rust.html" class="external-link">rust</a></code>
  package is used to draw a random sample
  from the marginal posterior of the hyperparameter vector \(\phi\).
  Then, conditional on these values, population parameters are sampled
  directly from the conditional posterior density of
  \(\theta\)1, ..., \(\theta\)\(J\) given \(\phi\) and the data.</p>
<p>We outline each <code>model</code>, specify the format of the
  <code>data</code>, give the default (log-)priors (up to an additive constant)
  and detail the choices of ratio-of-uniforms parameterization
  <code>param</code>.</p>
<p><strong>Beta-binomial:</strong> For \(j = 1, ..., J\),
  \(Yj | pj\) are i.i.d binomial\((nj, pj)\),
  where \(pj\) is the probability of success in group \(j\)
  and \(nj\) is the number of trials in group \(j\).
  \(pj\) are i.i.d. beta\((\alpha, \beta)\), so
  and \(\phi = (\alpha, \beta)\).
  <code>data</code> is a 2-column matrix: the numbers of successes in column 1
  and the corresponding numbers of trials in column 2.</p>
<p><em>Priors:</em></p>
<p><code>prior = "bda"</code> (the default):
\(log \pi(\alpha, \beta) = - 2.5 log(\alpha + \beta),
  \alpha &gt; 0, \beta &gt; 0.\) [See Section 5.3 of Gelman et al. (2014).]</p>
<p><code>prior = "gamma"</code>: independent gamma priors on \(\alpha\)
and \(\beta\), i.e.
\(log \pi(\alpha, \beta) =
  (s1 - 1)log\alpha - r1 \alpha +
  (s2 - 1)log\beta - r2 \beta,  \alpha &gt; 0, \beta &gt; 0.\)
where the respective shape (\(s1\), \(s2\)) and rate
(\(r1\), \(r2\)) parameters are specified using
<code>hpars</code> = \((s1, r1, s2, r2)\).  The default setting is
<code>hpars = c(1, 0.01, 1, 0.01).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\alpha, \beta\)),
 <code>param = "trans"</code> (the default) is
\(\phi1 = logit(\alpha/(\alpha+\beta)) = log(\alpha/\beta),
  \phi2 = log(\alpha+\beta)\).
See Section 5.3 of Gelman et al. (2014).</p>
<p><strong>Gamma-Poisson:</strong> For \(j = 1, ..., J\),
  \(Yj | \lambda\)j are i.i.d Poisson(\(e\)j\(\lambda\)j),
  where
  \(ej\) is the <em>exposure</em> in group \(j\), based on the
  total length of observation time and/or size of the population at
  risk of the event of interest and \(\lambda\)j is the mean number
  of events per unit of exposure.
  \(\lambda\)j are i.i.d. gamma\((\alpha, \beta)\), so
  \(\phi = (\alpha, \beta)\).
  <code>data</code> is a 2-column matrix: the counts \(yj\) of the numbers of
  events in column 1 and the corresponding exposures \(ej\) in column 2.</p>
<p><em>Priors:</em></p>
<p><code>prior = "gamma"</code> (the default): independent gamma priors
  on \(\alpha\) and \(\beta\), i.e.
\(log \pi(\alpha, \beta) =
  (s1 - 1)log\alpha - r1 \alpha +
  (s2 - 1)log\beta - r2 \beta,  \alpha &gt; 0, \beta &gt; 0.\)
where the respective shape (\(s1\), \(s2\)) and rate
(\(r1\), \(r2\)) parameters are specified using
<code>hpars</code> = \((s1, r1, s2, r2)\).  The default setting is
<code>hpars = c(1, 0.01, 1, 0.01).</code></p>
<p><em>Parameterizations for sampling:</em></p>
<p><code>param = "original"</code> is (\(\alpha, \beta\)),
 <code>param = "trans"</code> (the default) is
\(\phi1 = log(\alpha/\beta), \phi2 = log(\beta).\)</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gelman, A., Carlin, J. B., Stern, H. S. Dunson, D. B.,
 Vehtari, A. and Rubin, D. B. (2014) <em>Bayesian Data Analysis</em>.
 Chapman &amp; Hall / CRC.
  <a href="http://www.stat.columbia.edu/~gelman/book" class="external-link">http://www.stat.columbia.edu/~gelman/book</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The <code><a href="https://paulnorthrop.github.io/rust/reference/ru.html" class="external-link">ru</a></code> function in the <code>rust</code>
  package for details of the arguments that can be passed to <code>ru</code> via
  <code>hef</code>.</p>
<p><code><a href="hanova1.html">hanova1</a></code> for hierarchical one-way analysis of
  variance (ANOVA).</p>
<p><code><a href="set_user_prior.html">set_user_prior</a></code> to set a user-defined prior.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">############################ Beta-binomial #################################</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># ------------------------- Rat tumor data ------------------------------- #</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Default prior, sampling on (rotated) (log(mean), log(alpha + beta)) scale</span></span>
<span class="r-in"><span class="va">rat_res</span> <span class="op">&lt;-</span> <span class="fu">hef</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"beta_binom"</span>, data <span class="op">=</span> <span class="va">rat</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="co"># Hyperparameters alpha and beta</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># Parameterization used for sampling</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box       vals1       vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.00000000  0.00000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -0.2382163 -0.40313465 -0.03906170    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.2174510  0.05447431 -0.35297539    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   0.2231876  0.36718411 -0.06551353    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   0.2512577  0.05665707  0.44459818    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5083884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      alpha              beta        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   : 0.9621   Min.   :  5.185  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.: 1.7954   1st Qu.: 10.713  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median : 2.2742   Median : 13.281  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   : 2.5082   Mean   : 14.928  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.: 2.8243   3rd Qu.: 16.891  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :83.4309   Max.   :474.125  </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Choose rats with extreme sample probabilities</span></span>
<span class="r-in"><span class="va">pops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">rat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">rat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">rat</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">rat</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Population-specific posterior samples: separate plots</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, plot_type <span class="op">=</span> <span class="st">"both"</span>, which_pop <span class="op">=</span> <span class="va">pops</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># Population-specific posterior samples: one plot</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, plot_type <span class="op">=</span> <span class="st">"dens"</span>, which_pop <span class="op">=</span> <span class="va">pops</span>,</span>
<span class="r-in">     one_plot <span class="op">=</span> <span class="cn">TRUE</span>, add_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-4.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Default prior, sampling on (rotated) (alpha, beta) scale</span></span>
<span class="r-in"><span class="va">rat_res</span> <span class="op">&lt;-</span> <span class="fu">hef</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"beta_binom"</span>, data <span class="op">=</span> <span class="va">rat</span>, param <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box       vals1      vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.00000000  0.0000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -1.0464012 -1.85116847  0.8473716    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.7515215  0.06414713 -1.0929862    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   1.2453108  2.53614928  1.3267447    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   1.6246189  0.52814754  3.8051940    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5083884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      alpha              beta       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   : 0.9446   Min.   : 4.957  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.: 1.7791   1st Qu.:10.698  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median : 2.2275   Median :13.151  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   : 2.4029   Mean   :14.280  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.: 2.7970   3rd Qu.:17.027  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :10.8674   Max.   :58.777  </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># To produce a plot akin to Figure 5.3 of Gelman et al. (2014) we</span></span>
<span class="r-in"><span class="co"># (a) Use the same prior for (alpha, beta)</span></span>
<span class="r-in"><span class="co"># (b) Don't use axis rotation (rotate = FALSE)</span></span>
<span class="r-in"><span class="co"># (c) Plot on the scale used for ratio-of-uniforms sampling (ru_scale = TRUE)</span></span>
<span class="r-in"><span class="co"># (d) Note that the mode is relocated to (0, 0) in the plot</span></span>
<span class="r-in"><span class="va">rat_res</span> <span class="op">&lt;-</span> <span class="fu">hef</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"beta_binom"</span>, data <span class="op">=</span> <span class="va">rat</span>, rotate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># This is the estimated location of the posterior mode</span></span>
<span class="r-in"><span class="va">rat_res</span><span class="op">$</span><span class="va">f_mode</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -1.785783  2.741549</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># User-defined prior, passing parameters</span></span>
<span class="r-in"><span class="co"># (equivalent to prior = "gamma" with hpars = c(1, 0.01, 1, 0.01))</span></span>
<span class="r-in"><span class="va">user_prior</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">hpars</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">hpars</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">hpars</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"><span class="va">user_prior_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="set_user_prior.html">set_user_prior</a></span><span class="op">(</span><span class="va">user_prior</span>, hpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rat_res</span> <span class="op">&lt;-</span> <span class="fu">hef</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"beta_binom"</span>, data <span class="op">=</span> <span class="va">rat</span>, prior <span class="op">=</span> <span class="va">user_prior_fn</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rat_res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box       vals1       vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.00000000  0.00000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -0.2425978 -0.41087097 -0.04439263    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.2145118  0.05190271 -0.34376799    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   0.2280150  0.37607515 -0.07085000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   0.2730012  0.06004980  0.51162996    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5141388</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      alpha             beta        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   : 1.077   Min.   :  6.103  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.: 2.276   1st Qu.: 13.943  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median : 2.972   Median : 17.984  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   : 3.302   Mean   : 19.867  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.: 3.897   3rd Qu.: 23.456  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :18.579   Max.   :106.048  </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">############################ Gamma-Poisson #################################</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># ------------------------ Pump failure data ------------------------------ #</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">pump_res</span> <span class="op">&lt;-</span> <span class="fu">hef</span><span class="op">(</span>model <span class="op">=</span> <span class="st">"gamma_pois"</span>, data <span class="op">=</span> <span class="va">pump</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Hyperparameters alpha and beta</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pump_res</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"><span class="co"># Parameterization used for sampling</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pump_res</span>, ru_scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pump_res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ru bounding box:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                box       vals1       vals2 conv</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a        1.0000000  0.00000000  0.00000000    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1minus -0.5174980 -0.91869101 -0.06060116    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2minus -0.5150835  0.15757254 -0.92429417    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1plus   0.4124640  0.65433383 -0.11046433    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2plus   0.4224941  0.08788857  0.67847965    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> estimated probability of acceptance:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.5367687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample summary </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      alpha             beta       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Min.   :0.2889   Min.   :0.2452  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1st Qu.:0.7973   1st Qu.:1.2731  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Median :1.0759   Median :1.8298  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Mean   :1.1437   Mean   :2.1012  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3rd Qu.:1.4005   3rd Qu.:2.6880  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Max.   :3.2284   Max.   :7.7540  </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Choose pumps with extreme sample rates</span></span>
<span class="r-in"><span class="va">pops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">pump</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">pump</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">pump</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="va">pump</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pump_res</span>, params <span class="op">=</span> <span class="st">"pop"</span>, plot_type <span class="op">=</span> <span class="st">"dens"</span>, which_pop <span class="op">=</span> <span class="va">pops</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hef-11.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Paul J. Northrop, Benjamin D. Hall.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

